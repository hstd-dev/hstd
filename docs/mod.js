var l=(e,t=!1)=>{let r=new(t?WeakMap:Map),o=r.get.bind(r),n=r.set.bind(r);return s=>{let i=o(s);return i||(n(s,i=e(s)),i)}};var N=l(()=>({}),!0),P=l(e=>(addEventListener(e,t=>N(t.target)[e]?.forEach?.(r=>r(t)),{passive:!0}),(t,r)=>(N(r)[e]||=[]).push(t)));var p=(e,t)=>e?.constructor===t,$=e=>Object.isFrozen(e)&&p(e,Array),L=e=>typeof e[Symbol.asyncIterator]=="function";var{Promise:k,Function:M}=globalThis,O=Symbol.for("PTR_IDENTIFIER"),B={},I=()=>String.fromCharCode(...K()),h=e=>e?.[O],K=function*(e=52){let t=0;for(;t++<e;){let r=Math.floor(Math.random()*31);yield 127+r+(r>141)+(r>156)}},D={is:Object.is,leq:(e,t)=>e==t,seq:(e,t)=>e===t,or:(e,t)=>e||t,and:(e,t)=>e&&t,xor:(e,t)=>e^t,sum:(e,t)=>e+t,sub:(e,t)=>e-t,mul:(e,t)=>e*t,div:(e,t)=>e/t,mod:(e,t)=>e%t},W=Object.assign({[Symbol.toPrimitive]([e],t){return typeof t=="string"?t==="string"&&p(e,M)?this.publish():e.toString():t===O},watch(e,t){return t&&e[2].set(t,[e[1].push(t)-1,!0]),this},abort(e,t){if(t){let r=e[2].get(t);r[1]=!1,delete e[1][r?.[0]]}return this},into([e],t=r=>r){let r=n=>{let s=t(n);return p(s,k)?(s.then(i=>o.$=i),void 0):o.$=s},o=g();return r(e),this.watch(r),o},until(e,t){return new k(r=>{let o=n=>(p(t,M)?t(n):n===t)?(this.abort(o),r(this)):0;this.watch(o)})},switch(){return this.$=!this.$,this},not(){return this.into(e=>!e)},bool(){return this.into(e=>!!e)},isit(e,t){return this.into(r=>r?e:t)},tick(){let e=!1;return this.into(()=>e=!e)},toString(e,t){let r=h(t),o=this.into(n=>n.toString(r?t.$:t));return r&&t.watch(n=>o.$=this.$.toString(n)),o},publish(e){let t=Symbol(e[3]);return B[t]=this,t},timeout(e,t){let r=g(this.$),o;return this.watch(n=>{clearTimeout(o),o=setTimeout(()=>r.$=n,h(t)?t.$:t)}),r},from(e,t){let r=!0;return t(o=>r?this.$=o:o,o=>r=o),this}},...Object.keys(D).map(e=>({[e](t,r){let o=h(r),n=D[e],s=this.into(i=>n(i,o?r.$:r));return o&&r.watch(i=>s.$=n(this.$,i)),s}}))),H=new WeakMap,U=(e,t)=>(...r)=>{let o=r.map((s,i)=>h(s)?s.watch(c=>(o[i]=c,n.$=e.$[t](...o))).$:s),n=e.into(s=>s[t](...o));return n},X=e=>function(t,r,o){let n=e[2];return(r||t!==e[0])&&(e[0]=t,e[1].forEach(s=>n.get(s)?.[1]?s(t):0)),o},Q=l(e=>l(t=>W[e].bind(H.get(t),t),!0)),Y=hasOwnProperty.bind(W),g=(e,[t,r]=[])=>{let o=[],n=new WeakMap,s=Object.assign({name:"$",writable:!0},r),i=[e,o,n,R+s.name],c=X(i),a=new Proxy(Object.defineProperties(Object(function(...f){let[m]=i;return p(m,M)?m.apply(null,f):m}),{name:{value:s.name}}),{get(f,m,d){let[u]=i;return m==="$"?u:m==="refresh"?c.bind(null,u,!0,d):m==="constructor"?!0:m===Symbol.asyncIterator?!1:m===O?!0:m===Symbol.hasInstance?()=>!1:Y(m)?Q(m)(i):p(u[m],M)?U(d,m):d.into(x=>x[m])},set(f,m,d){if(s.writable)if(m=="$"){let u=t?t(d):d;p(u,k)?u.then(c):c(u)}else i[0][m]=h(d)?d.watch(u=>i[0][m]=u).$:d;return!0}});return H.set(i,a),a},R;for(;(R=I())in globalThis;);Object.defineProperty(globalThis,R,{value:e=>B[e],configurable:!1,enumerable:!1});var Z=l(e=>{let t=I();return[e.join(t),new RegExp(t,"g")]},!0),J=(e,t)=>{let[r,o]=Z(e),n=t.map((c,a)=>h(c)?c.watch(()=>(n[a]=c.$,i.$=s())).$:c),s=(c=0)=>r.replaceAll(o,()=>n[c++]),i=g(s());return i},q={},$t=new Proxy((e,...t)=>($(e)&&$(e?.raw)?J:g)(e,t),{get:(e,t)=>{if(t===Symbol.hasInstance)return h;if(t==="this")return;let r=q[t];return!r&&!p(globalThis[t],Function)&&(r=q[t]=g(globalThis[t]),P("resize",({target:o})=>r.$=o[t],globalThis)),r||V[t]}}),V=g(globalThis);var v=e=>e.prototype;var T=(e=36)=>(b^=(b^A)<<13,b^=b>>17,(b^=b<<5)*(b<0?-1:1)).toString(e),A=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER),b=1;A+=!(A%2);b=T();var{replaceWith:tt}=v(Element),et=Symbol.for("HTML_IDENTIFIER"),rt=document.createDocumentFragment(),ot={[Symbol.toPrimitive](e){return typeof e=="string"?[...this[Symbol.iterator]().map(t=>t.outerHTML)].join(""):e===et},toString(){return this[Symbol.toPrimitive]("string")}},nt={get(e,t){if(t in Element.prototype)return;let r=e[t];return p(r,Function)?r.bind(e):r},set(e,t,r){return t in Element.prototype||F(null,e,{[t]:r}),!0}},F=(e,t,r)=>Reflect.ownKeys(t).forEach(o=>{let n=t[o],s=typeof o;if(s=="symbol"){let i=globalThis[o.description.slice(0,52)]?.(o);if(!h(i))return;let c=i.$(n,e);if(c?.constructor!==Object)return;F(e,c,r)}else if(s=="string")if(o=="id"){let i=new Proxy(e,nt);h(n)?n.$===void 0&&(n.$=i):n in r||(r[n]=i)}else e[o]=n}),w=()=>Object.assign(document.createElement("div"),{hidden:!0}),E=(e,t)=>{let r=w();if(t instanceof Promise)t.then(E.bind(null,r)),e.replaceWith(r);else if(L(t)){let o=w(),n=w(),s=!0,i=!0,c;(async()=>{for await(let a of t){if(s&&a==="append"){i=s=!1;continue}if(s=!1,i){let f=o.nextSibling;for(;f&&f!==n;){let m=f.nextSibling;f.remove(),f=m}}(c||=n.parentNode).insertBefore(r,n),E(r,a)}o.remove(),n.remove()})(),e.replaceWith(o,n)}else if(h(t)){let o=new Text(t.watch(n=>o.textContent=n).$);e.replaceWith(o)}else tt.apply(e,p(t,Array)?t.map(o=>[...o]).flat(1):t instanceof NodeList?t:[new Text(t)])},it=l(e=>{let t="t"+T(),r=e.join(t),o=0,n=t.length,s=[...r.matchAll(new RegExp(t+"(?!([^<]*>))","g"))].map(({0:{length:f},index:m})=>m+f),i=[],c=w(),a=c.cloneNode.bind(c,!0);return rt.appendChild(c),c.innerHTML=r.replaceAll(t,(f,m)=>(i[o++]=s.includes(m+n))?`<br ${t}>`:t),f=>{let m=a(),d={};return m.querySelectorAll(`[${t}]`).forEach((u,x)=>{let C=f[x];i[x]?E(u,C):F(u,C,d),u.removeAttribute(t)}),Object.assign(m.childNodes,ot,{on(...u){return u.forEach(x=>x(d)),this}})}},!0),Rt=(e,...t)=>{if($(e))return it(e)(t);let r=w();return E(r,e),r};var y=(e,t)=>{let r=l(i=>g(e(i),void 0,{name:t?t(i):""})),o=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():r(c).publish()}}),n=g(i=>Reflect.ownKeys(i).reduce((c,a)=>(c[o[a]]=i[a],c),{})),s=n.publish.bind(n);return o};var Dt=y(P,l(e=>"on."+e));var G=l(e=>{let t;for(;document.querySelector(`[${t=`h${T()}`}]`););return e.setAttribute(t,""),t},!0);var _=!1,S={},st=/[A-Z]{1}/g,ct=l(e=>"-"+e.toLowerCase()),z=l(e=>e.replaceAll(st,ct)),Ut=y(e=>(t,r)=>{let o=r.style,n=G(r),s=z(e);h(t)?o.setProperty(s,t.watch(i=>o.setProperty(s,i)).$):(_||(_=!0,queueMicrotask(()=>{document.head.append(Object.assign(document.createElement("style"),{textContent:Object.entries(S).map(([i,c])=>`[${i}]{${c}}`).join("")})),_=!1,S={}})),S[n]=(S[n]||"")+`${s}:${t};`)},l(e=>"css-"+z(e)));var mt=P("input"),Zt=y(e=>(t,r)=>{if(r instanceof HTMLElement){let o=!1;mt(({target:{[e]:n}})=>{o=!0,t.$="number\0range".includes(r.type)?Number(n):n,o=!1},r),r[e]=t.watch(n=>o?0:r[e]=n).$}});var j=Symbol();var lt=()=>{let e=!0,t=[],r=[],o=(i,c)=>{e&&(e=!1,queueMicrotask(()=>e=!0),(i?t:r).forEach(a=>a(c)),t.length=r.length=0)},n=o.bind(null,!0),s=o.bind(null,!1);return(i=j)=>i===j?new Promise((c,a)=>{t.push(c),r.push(a)}):i instanceof Error?s(i):n(i)};export{$t as $,l as Memo,g as Pointer,y as Prop,lt as Task,Ut as css,Rt as h,Zt as io,P as listen,Dt as on};
