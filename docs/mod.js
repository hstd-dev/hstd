var M={},F=function*(t=52){let e;for(let n=0;n<t;n++)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},j=()=>String.fromCharCode(...F()),w=Symbol.for("PTR_IDENTIFIER"),h=t=>t?.[w],$=(t,e)=>t?.constructor===e,E=t=>Object.isFrozen(t)&&Array.isArray(t),P={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},H=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===w},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=d(e(t));return this.watch(r=>n.$=e(r)),n},until(t,e){return new Promise(n=>{let r=o=>(typeof e=="function"?e(o):o===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=h(e),r=this.into(o=>o.toString(n?e.$:e));return n&&e.watch(o=>r.$=this.$.toString(o)),r},publish(t){let e=Symbol(t[3]);return M[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(P).map(t=>({[t](e,n){let r=h(n),o=P[t],i=this.into(s=>o(s,r?n.$:n));return r&&n.watch(s=>i.$=o(this.$,s)),i}}))),d=(t,e=r=>r,n={})=>{let r=[],o=new WeakMap,i=Object.assign({name:"$"},n),s=function(l,u,a){return(u||l!==c[0])&&(c[0]=l,r.forEach(m=>o.get(m)?.[1]?m(l):0)),a},c=[t,r,o,x+(n.name||""),s];return new Proxy(Object.defineProperties(Object(function(...l){let[u]=c;return $(u,Function)?u.apply(null,l):u}),{name:{value:i.name}}),{get(l,u,a){let[m]=c;return u==="$"?m:u==="refresh"?s.bind(null,m,!0,a):u==="constructor"||u===w?!0:u===Symbol.hasInstance?()=>!1:H[u]?.bind?.(a,c)||($(m[u],Function)?function(...g){let y=g.map((f,L)=>h(f)?(f.watch(k=>(y[L]=k,S.$=a.$[u](...y))),f.$):f),S=a.into(f=>f[u](...y));return S}:a.into(g=>g[u]))},set(l,u,a){if(u=="$"){let m=e?e(a):a;$(m,Promise)?m.then(s):s(m)}return!0}})},N=(t,...e)=>{let n=j(),r=t.join(n),o=new RegExp(n,"g"),i=e.map((l,u)=>h(l)?(l.watch(()=>(i[u]=l.$,c.$=s())),l.$):l),s=(l=0)=>r.replaceAll(o,()=>i[l++]),c=d(s());return c},W=(t,...e)=>(E(t)&&E(t?.raw)?N:d).call(null,t,...e),x;for(;(x=j())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>M[t],configurable:!1,enumerable:!1});var p=(t,e)=>{let n={},r=new Proxy({},{get(s,c){return c===Symbol.toPrimitive?i:c==="$"?i():(n[c]||=d(t.bind(null,c),void 0,{name:e?e(c):""})).publish()}}),o=d(s=>{let c={};return Object.keys(s).forEach(l=>c[r[l]]=s[l]),c}),i=()=>o.publish();return r};var I="\0",b=new WeakMap,T=function(t,e,n){I.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>b.get(r.target)?.[t]?.forEach(o=>o(r)),{passive:!0}),I+=t+"\0"),b.has(n)||b.set(n,{}),(b.get(n)[t]||=[]).push(e)},z=p(T,t=>"on."+t);var R=16,C=Symbol.for("HTML_IDENTIFIER"),B=function*(t=R){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},O=new WeakMap,D=document.createDocumentFragment(),Z={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===C},toString(){return this[Symbol.toPrimitive]("string")}},q={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},A=(t,e)=>Reflect.ownKeys(e).forEach(G.bind(null,t,e)),G=function(t,e,n){let[r,o]=t,i=e[n],s=typeof n;if(s=="symbol"){let c=globalThis[n.description.slice(0,52)]?.(n);if(!h(c))return;let l=c.$(i,o);if(l?.constructor!==Object)return;A(t,l)}else s=="string"&&(h(i)?(o[n]=i.watch(c=>o[n]=c).$,"\0value\0checked\0".includes(`\0${n}\0`)&&n in o&&T("input",({target:{[n]:c}})=>i.$="number\0range".includes(o.type)?Number(c):c,o)):n=="id"&&!(i in r)?r[i]=new Proxy(o,q):o[n]=i)},K=function(t,e,n,r,o,i){let s=n[i];t[i]?A([r,o],s):o.replaceWith(...s[Symbol.toPrimitive]?.(C)?s:h(s)?s.text():[new Text(s)]),o.removeAttribute(e)},J=function(t,e,n,r,o){let i=t.cloneNode(!0),s={};return i.querySelectorAll(`[${r}]`).forEach(K.bind(null,e,r,o,s)),Object.assign(i.childNodes,n,{then(c){return c(s),this}})},Q=(t,...e)=>{let n=O.get(t);if(!n){let r=t.join(""),o=0,i;for(;r.includes(i=String.fromCharCode(...B())););r=t.join(i);let s=[...r.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${i}`,"g"))].map(({0:{length:u},index:a})=>a+u),c=[],l=document.createElement("div");D.appendChild(l),l.innerHTML=r.replaceAll(i,(u,a)=>(c[o++]=s.includes(a+R))?i:`<br ${i}>`),O.set(t,n=J.bind(null,l,c,Z,i))}return n(e)};var U=/[A-Z]{1}/g,X={},Y=t=>X[t]||="-"+t.toLowerCase(),v={},_=t=>v[t]||=t.replaceAll(U,Y),V=p(function(t,e,{style:n}){let r=_(t);n.setProperty(r,h(e)?(e.watch(o=>n.setProperty(r,o)),e.$):e)},t=>"css-"+_(t));export{W as $,V as css,Q as h,z as on,p as prop};
