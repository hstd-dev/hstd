var m=(t,e=!1,o=new(e?WeakMap:Map))=>r=>{let n;return o.has(r)?o.get(r):(o.set(r,n=t(r)),n)};var A="\0",O=m(()=>({}),!0),y=t=>(e,o)=>{A.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>O(r.target)[t]?.forEach?.(n=>n(r)),{passive:!0}),A+=t+"\0"),(O(o)[t]||=[]).push(e)};var f=(t,e)=>t?.constructor===e,T=t=>Object.isFrozen(t)&&f(t,Array);var{Promise:P,Function:$}=globalThis,C=Symbol.for("PTR_IDENTIFIER"),R={},E=()=>String.fromCharCode(...W()),u=t=>t?.[C],W=function*(t=52){let e=0;for(;e++<t;){let o=Math.floor(Math.random()*31);yield 127+o+(o>141)+(o>156)}},j={is:Object.is,leq:(t,e)=>t==e,seq:(t,e)=>t===e,or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},_=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&f(t,$)?this.publish():t.toString():e===C},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let o=t[2].get(e);o[1]=!1,delete t[1][o?.[0]]}return this},into([t],e=o=>o){let o=n=>{let s=e(n);return f(s,P)?(s.then(i=>r.$=i),void 0):r.$=s},r=b();return o(t),this.watch(o),r},until(t,e){return new P(o=>{let r=n=>(f(e,$)?e(n):n===e)?(this.abort(r),o(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},isit(t,e){return this.into(o=>o?t:e)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let o=u(e),r=this.into(n=>n.toString(o?e.$:e));return o&&e.watch(n=>r.$=this.$.toString(n)),r},publish(t){let e=Symbol(t[3]);return R[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let o=b(this.$),r;return this.watch(n=>{clearTimeout(r),r=setTimeout(()=>o.$=n,u(e)?e.$:e)}),o}},...Object.keys(j).map(t=>({[t](e,o){let r=u(o),n=j[t],s=this.into(i=>n(i,r?o.$:o));return r&&o.watch(i=>s.$=n(this.$,i)),s}}))),k=new WeakMap,q=(t,e)=>(...o)=>{let r=o.map((s,i)=>u(s)?s.watch(c=>(r[i]=c,n.$=t.$[e](...r))).$:s),n=t.into(s=>s[e](...r));return n},G=t=>function(e,o,r){let n=t[2];return(o||e!==t[0])&&(t[0]=e,t[1].forEach(s=>n.get(s)?.[1]?s(e):0)),r},K=m(t=>m(e=>_[t].bind(k.get(e),e),!0)),Z=hasOwnProperty.bind(_),b=(t,[e,o]=[])=>{let r=[],n=new WeakMap,s=Object.assign({name:"$",writable:!0},o),i=[t,r,n,S+s.name],c=G(i),p=new Proxy(Object.defineProperties(Object(function(...d){let[a]=i;return f(a,$)?a.apply(null,d):a}),{name:{value:s.name}}),{get(d,a,l){let[h]=i;return a==="$"?h:a==="refresh"?c.bind(null,h,!0,l):a==="constructor"||a===C?!0:a===Symbol.hasInstance?()=>!1:Z(a)?K(a)(i):f(h[a],$)?q(l,a):l.into(g=>g[a])},set(d,a,l){if(s.writable)if(a=="$"){let h=e?e(l):l;f(h,P)?h.then(c):c(h)}else i[0][a]=u(l)?l.watch(h=>i[0][a]=h).$:l;return!0}});return k.set(i,p),p},S;for(;(S=E())in globalThis;);Object.defineProperty(globalThis,S,{value:t=>R[t],configurable:!1,enumerable:!1});var Q=m(t=>{let e=E();return[t.join(e),new RegExp(e,"g")]},!0),X=(t,e)=>{let[o,r]=Q(t),n=e.map((c,p)=>u(c)?c.watch(()=>(n[p]=c.$,i.$=s())).$:c),s=(c=0)=>o.replaceAll(r,()=>n[c++]),i=b(s());return i},F={},dt=new Proxy((t,...e)=>(T(t)&&T(t?.raw)?X:b)(t,e),{get:(t,e)=>{if(e===Symbol.hasInstance)return u;if(e==="this")return;let o=F[e];return!o&&!f(globalThis[e],Function)&&(o=F[e]=b(globalThis[e]),y("resize",({target:r})=>o.$=r[e],globalThis)),o||v[e]}}),v=b(globalThis);var L=t=>t.prototype;var w=(t=36)=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(t);var{replaceWith:J}=L(Element),N=Symbol.for("HTML_IDENTIFIER"),U=document.createDocumentFragment(),Y={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===N},toString(){return this[Symbol.toPrimitive]("string")}},V={get(t,e){let o=t[e];return f(o,Function)?o.bind(t):o}},tt=y("input"),B=(t,e,o)=>Reflect.ownKeys(o).forEach(r=>{let n=o[r],s=typeof r;if(s=="symbol"){let i=globalThis[r.description.slice(0,52)]?.(r);if(!u(i))return;let c=i.$(n,e);if(c?.constructor!==Object)return;B(t,e,c)}else s=="string"&&(u(n)?(e[r]=n.watch(i=>e[r]=i).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in e&&tt(({target:{[r]:i}})=>n.$="number\0range".includes(e.type)?Number(i):i,e)):e[r]=n,r=="id"&&!(n in t)&&(t[n]=new Proxy(e,V)))}),et=m(t=>{let e=t.join(""),o=0,r="t";for(;e.includes(r+=w()););e=t.join(r);let n=r.length,s=[...e.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${r}`,"g"))].map(({0:{length:p},index:d})=>d+p),i=[],c=document.createElement("div");return U.appendChild(c),c.innerHTML=e.replaceAll(r,(p,d)=>(i[o++]=s.includes(d+n))?r:`<br ${r}>`),p=>{let d=c.cloneNode(!0),a={};return d.querySelectorAll(`[${r}]`).forEach((l,h)=>{let g=p[h];i[h]?B(a,l,g):J.apply(l,f(g,Array)?g.map(H=>[...H]).flat(1):g[Symbol.toPrimitive]?.(N)?g:u(g)?g.text():[new Text(g)]),l.removeAttribute(r)}),Object.assign(d.childNodes,Y,{then(...l){return l.forEach(h=>h(a)),this}})}},!0),Et=(t,...e)=>et(t)(e);var x=(t,e)=>{let o=m(i=>b(t(i),void 0,{name:e?e(i):""})),r=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():o(c).publish()}}),n=b(i=>{let c={};return Reflect.ownKeys(i).forEach(p=>c[r[p]]=i[p]),c}),s=n.publish.bind(n);return r};var _t=x(y,m(t=>"on."+t));var z=m(t=>{let e;for(;t.hasAttribute(e=`h${w()}`););return t.setAttribute(e,""),e},!0);var M=!1,I={},Wt=document.createElement("style"),rt=/[A-Z]{1}/g,ot=m(t=>"-"+t.toLowerCase()),D=m(t=>t.replaceAll(rt,ot)),qt=x(t=>(e,o)=>{let r=o.style,n=z(o),s=D(t);u(e)?r.setProperty(s,e.watch(i=>r.setProperty(s,i)).$):(M||(M=!0,queueMicrotask(()=>{document.head.append(Object.assign(document.createElement("style"),{textContent:Object.entries(I).map(([i,c])=>`[${i}]{${c.join("")}}`).join("")})),M=!1,I={}})),(I[n]||=[]).push(`${s}:${e};`))},m(t=>"css-"+D(t)));export{dt as $,qt as css,Et as h,y as listen,_t as on};
