var a=t=>{let e=new WeakMap,n=new Map;return r=>{let o="function\0object".includes(typeof r)?e:n,s;return o.has(r)?o.get(r):(o.set(r,s=t(r)),s)}};var P="\0",S=a(()=>({})),p=function(t,e,n){P.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>S(r.target)[t]?.forEach?.(o=>o(r)),{passive:!0}),P+=t+"\0"),(S(n)[t]||=[]).push(e)};var m=(t,e)=>t?.constructor===e,b=t=>Object.isFrozen(t)&&m(t,Array);var{Promise:y,Function:d}=globalThis,T=Symbol.for("PTR_IDENTIFIER"),E={},x=()=>String.fromCharCode(...F()),l=t=>t?.[T],F=function*(t=52){let e=0;for(;e++<t;){let n=Math.floor(Math.random()*31);yield 127+n+(n>141)+(n>156)}},C={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},O=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&m(t,d)?this.publish():t.toString():e===T},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=o=>{let s=e(o);return m(s,y)?(s.then(i=>r.$=i),void 0):r.$=s},r=u();return n(t),this.watch(n),r},until(t,e){return new y(n=>{let r=o=>(m(e,d)?e(o):o===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},isit(t,e){return this.into(n=>n?t:e)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=l(e),r=this.into(o=>o.toString(n?e.$:e));return n&&e.watch(o=>r.$=this.$.toString(o)),r},publish(t){let e=Symbol(t[3]);return E[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let n=u(this.$),r;return this.watch(o=>{clearTimeout(r),r=setTimeout(()=>n.$=o,l(e)?e.$:e)}),n}},...Object.keys(C).map(t=>({[t](e,n){let r=l(n),o=C[t],s=this.into(i=>o(i,r?n.$:n));return r&&n.watch(i=>s.$=o(this.$,i)),s}}))),j=function(t,e,n,r){let o=t[2];return(n||e!==t[0])&&(t[0]=e,t[1].forEach(s=>o.get(s)?.[1]?s(e):0)),r},_=function(t,e,...n){let r=n.map((s,i)=>l(s)?s.watch(c=>(r[i]=c,o.$=t.$[e](...r))).$:s),o=t.into(s=>s[e](...r));return o},H=function(t,e,n,r,o){let[s]=t;return r==="$"?s:r==="refresh"?e.bind(null,s,!0,o):r==="constructor"||r===T?!0:r===Symbol.hasInstance?()=>!1:O[r]?.bind?.(o,t)||(m(s[r],d)?_.bind(null,o,r):o.into(i=>i[r]))},L=function(t,e,n,r,o,s,i){if(e.writable)if(s=="$"){let c=n?n(i):i;m(c,y)?c.then(r):r(c)}else t[0][s]=l(i)?i.watch(c=>t[0][s]=c).$:i;return!0},u=(t,[e,n]=[])=>{let r=[],o=new WeakMap,s=Object.assign({name:"$",writable:!0},n),i=[t,r,o,$+s.name],c=j.bind(null,i);return new Proxy(Object.defineProperties(Object(function(...h){let[f]=i;return m(f,d)?f.apply(null,h):f}),{name:{value:s.name}}),{get:H.bind(null,i,c),set:L.bind(null,i,s,e,c)})},$;for(;($=x())in globalThis;);Object.defineProperty(globalThis,$,{value:t=>E[t],configurable:!1,enumerable:!1});var N=a(t=>{let e=x();return[t.join(e),new RegExp(e,"g")]}),W=(t,e)=>{let[n,r]=N(t),o=e.map((c,h)=>l(c)?c.watch(()=>(o[h]=c.$,i.$=s())).$:c),s=(c=0)=>n.replaceAll(r,()=>o[c++]),i=u(s());return i},M={};var lt=new Proxy({},{get(t,e){}}),at=new Proxy((t,...e)=>(b(t)&&b(t?.raw)?W:u)(t,e),{get:(t,e)=>{if(e===Symbol.hasInstance)return l;if(e==="this")return;let n=M[e];return!n&&!m(globalThis[e],Function)&&(n=M[e]=u(globalThis[e]),p("resize",({target:r})=>n.$=r[e],globalThis)),n||z[e]}}),z=u(globalThis);var w=t=>t.prototype;var{replaceWith:k}=w(Element),{cloneNode:B}=w(Node),I=Symbol.for("HTML_IDENTIFIER"),D=document.createDocumentFragment(),G={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===I},toString(){return this[Symbol.toPrimitive]("string")}},K={get(t,e){let n=t[e];return m(n,Function)?n.bind(t):n}},R=(t,e,n)=>Reflect.ownKeys(n).forEach(Z.bind(null,t,e,n)),Z=function(t,e,n,r){let o=n[r],s=typeof r;if(s=="symbol"){let i=globalThis[r.description.slice(0,52)]?.(r);if(!l(i))return;let c=i.$(o,e);if(c?.constructor!==Object)return;R(id__ref,c)}else s=="string"&&(l(o)?(e[r]=o.watch(i=>e[r]=i).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in e&&p("input",({target:{[r]:i}})=>o.$="number\0range".includes(e.type)?Number(i):i,e)):e[r]=o,r=="id"&&!(o in t)&&(t[o]=new Proxy(e,K)))},q=function([t,e],n,r,o,s){let i=n[s];e[s]?R(r,o,i):k.apply(o,i[Symbol.toPrimitive]?.(I)?i:l(i)?i.text():[new Text(i)]),o.removeAttribute(t)},v=function(t,e){return e(t),this},Q=function(t,e){let n=t[2](),r={};return n.querySelectorAll(`[${t[0]}]`).forEach(q.bind(null,t,e,r)),Object.assign(n.childNodes,G,{then:v.bind(null,r)})},X=a(t=>{let e=t.join(""),n=0,r="t";for(;e.includes(r+=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)).toString(36)););e=t.join(r);let o=r.length,s=[...e.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${r}`,"g"))].map(({0:{length:h},index:f})=>f+h),i=[],c=document.createElement("div");return D.appendChild(c),c.innerHTML=e.replaceAll(r,(h,f)=>(i[n++]=s.includes(f+o))?r:`<br ${r}>`),Q.bind(null,[r,i,B.bind(c,!0)])}),bt=(t,...e)=>X(t)(e);var g=(t,e)=>{let n={},r=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():(n[c]||=u(t.bind(null,c),void 0,{name:e?e(c):""})).publish()}}),o=u(i=>{let c={};return Reflect.ownKeys(i).forEach(h=>c[r[h]]=i[h]),c}),s=()=>o.publish();return r};var St=g(p,a(t=>"on."+t));var J=/[A-Z]{1}/g,U=a(t=>"-"+t.toLowerCase()),A=a(t=>t.replaceAll(J,U)),Rt=g(function(t,e,{style:n}){let r=A(t);n.setProperty(r,l(e)?e.watch(o=>n.setProperty(r,o)).$:e)},a(t=>"css-"+A(t)));export{at as $,Rt as css,bt as h,p as listen,St as on};
