var a=(t,e=!1,o=new(e?WeakMap:Map))=>r=>{let n;return o.has(r)?o.get(r):(o.set(r,n=t(r)),n)};var C="\0",E=a(()=>({}),!0),p=function(t,e,o){C.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>E(r.target)[t]?.forEach?.(n=>n(r)),{passive:!0}),C+=t+"\0"),(E(o)[t]||=[]).push(e)};var h=(t,e)=>t?.constructor===e,w=t=>Object.isFrozen(t)&&h(t,Array);var{Promise:T,Function:y}=globalThis,x=Symbol.for("PTR_IDENTIFIER"),M={},P=()=>String.fromCharCode(...N()),m=t=>t?.[x],N=function*(t=52){let e=0;for(;e++<t;){let o=Math.floor(Math.random()*31);yield 127+o+(o>141)+(o>156)}},I={is:Object.is,leq:(t,e)=>t==e,seq:(t,e)=>t===e,or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},O=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&h(t,y)?this.publish():t.toString():e===x},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let o=t[2].get(e);o[1]=!1,delete t[1][o?.[0]]}return this},into([t],e=o=>o){let o=n=>{let s=e(n);return h(s,T)?(s.then(i=>r.$=i),void 0):r.$=s},r=f();return o(t),this.watch(o),r},until(t,e){return new T(o=>{let r=n=>(h(e,y)?e(n):n===e)?(this.abort(r),o(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},isit(t,e){return this.into(o=>o?t:e)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let o=m(e),r=this.into(n=>n.toString(o?e.$:e));return o&&e.watch(n=>r.$=this.$.toString(n)),r},publish(t){let e=Symbol(t[3]);return M[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let o=f(this.$),r;return this.watch(n=>{clearTimeout(r),r=setTimeout(()=>o.$=n,m(e)?e.$:e)}),o}},...Object.keys(I).map(t=>({[t](e,o){let r=m(o),n=I[t],s=this.into(i=>n(i,r?o.$:o));return r&&o.watch(i=>s.$=n(this.$,i)),s}}))),_=new WeakMap,k=function(t,e,o,r){let n=t[2];return(o||e!==t[0])&&(t[0]=e,t[1].forEach(s=>n.get(s)?.[1]?s(e):0)),r},z=function(t,e,...o){let r=o.map((s,i)=>m(s)?s.watch(c=>(r[i]=c,n.$=t.$[e](...r))).$:s),n=t.into(s=>s[e](...r));return n},H=a(t=>a(e=>O[t].bind(_.get(e),e),!0)),W=hasOwnProperty.bind(O),f=(t,[e,o]=[])=>{let r=[],n=new WeakMap,s=Object.assign({name:"$",writable:!0},o),i=[t,r,n,S+s.name],c=k.bind(null,i),b=new Proxy(Object.defineProperties(Object(function(...g){let[l]=i;return h(l,y)?l.apply(null,g):l}),{name:{value:s.name}}),{get(g,l,u){let[d]=i;return l==="$"?d:l==="refresh"?c.bind(null,d,!0,u):l==="constructor"||l===x?!0:l===Symbol.hasInstance?()=>!1:W(l)?H(l)(i):h(d[l],y)?z.bind(null,u,l):u.into(L=>L[l])},set(g,l,u){if(s.writable)if(l=="$"){let d=e?e(u):u;h(d,T)?d.then(c):c(d)}else i[0][l]=m(u)?u.watch(d=>i[0][l]=d).$:u;return!0}});return _.set(i,b),b},S;for(;(S=P())in globalThis;);Object.defineProperty(globalThis,S,{value:t=>M[t],configurable:!1,enumerable:!1});var D=a(t=>{let e=P();return[t.join(e),new RegExp(e,"g")]},!0),q=(t,e)=>{let[o,r]=D(t),n=e.map((c,b)=>m(c)?c.watch(()=>(n[b]=c.$,i.$=s())).$:c),s=(c=0)=>o.replaceAll(r,()=>n[c++]),i=f(s());return i},A={},ht=new Proxy((t,...e)=>(w(t)&&w(t?.raw)?q:f)(t,e),{get:(t,e)=>{if(e===Symbol.hasInstance)return m;if(e==="this")return;let o=A[e];return!o&&!h(globalThis[e],Function)&&(o=A[e]=f(globalThis[e]),p("resize",({target:r})=>o.$=r[e],globalThis)),o||G[e]}}),G=f(globalThis);var R=t=>t.prototype;var{replaceWith:K}=R(Element),F=Symbol.for("HTML_IDENTIFIER"),Z=document.createDocumentFragment(),v={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===F},toString(){return this[Symbol.toPrimitive]("string")}},X={get(t,e){let o=t[e];return h(o,Function)?o.bind(t):o}},j=(t,e,o)=>Reflect.ownKeys(o).forEach(r=>{let n=o[r],s=typeof r;if(s=="symbol"){let i=globalThis[r.description.slice(0,52)]?.(r);if(!m(i))return;let c=i.$(n,e);if(c?.constructor!==Object)return;j(t,e,c)}else s=="string"&&(m(n)?(e[r]=n.watch(i=>e[r]=i).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in e&&p("input",({target:{[r]:i}})=>n.$="number\0range".includes(e.type)?Number(i):i,e)):e[r]=n,r=="id"&&!(n in t)&&(t[n]=new Proxy(e,X)))}),J=(t,e)=>(o,r)=>(n,s)=>{let i=o[s];e[s]?j(r,n,i):K.apply(n,h(i,Array)?i.map(c=>[...c]).flat(1):i[Symbol.toPrimitive]?.(F)?i:m(i)?i.text():[new Text(i)]),n.removeAttribute(t)},Q=t=>function(e){return e(t),this},U=a(t=>{let e=t.join(""),o=0,r="t";for(;e.includes(r+=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)).toString(36)););e=t.join(r);let n=r.length,s=[...e.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${r}`,"g"))].map(({0:{length:g},index:l})=>l+g),i=[],c=document.createElement("div");Z.appendChild(c),c.innerHTML=e.replaceAll(r,(g,l)=>(i[o++]=s.includes(l+n))?r:`<br ${r}>`);let b=J(r,i);return g=>{let l=c.cloneNode(!0),u={};return l.querySelectorAll(`[${r}]`).forEach(b(g,u)),Object.assign(l.childNodes,v,{then:Q.bind(null,u)})}},!0),$t=(t,...e)=>U(t)(e);var $=(t,e)=>{let o={},r=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():(o[c]||=f(t.bind(null,c),void 0,{name:e?e(c):""})).publish()}}),n=f(i=>{let c={};return Reflect.ownKeys(i).forEach(b=>c[r[b]]=i[b]),c}),s=()=>n.publish();return r};var Et=$(p,a(t=>"on."+t));var Y=/[A-Z]{1}/g,V=a(t=>"-"+t.toLowerCase()),B=a(t=>t.replaceAll(Y,V)),At=$(function(t,e,{style:o}){let r=B(t);o.setProperty(r,m(e)?e.watch(n=>o.setProperty(r,n)).$:e)},a(t=>"css-"+B(t)));export{ht as $,At as css,$t as h,p as listen,Et as on};
