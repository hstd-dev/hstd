var m=(e,t=!1,r=new(t?WeakMap:Map))=>n=>{let o;return r.has(n)?r.get(n):(r.set(n,o=e(n)),o)};var A="\0",j=m(()=>({}),!0),$=e=>(t,r)=>{A.includes(`\0${e}\0`)||(globalThis.addEventListener(e,n=>j(n.target)[e]?.forEach?.(o=>o(n)),{passive:!0}),A+=e+"\0"),(j(r)[e]||=[]).push(t)};var f=(e,t)=>e?.constructor===t,P=e=>Object.isFrozen(e)&&f(e,Array);var{Promise:C,Function:x}=globalThis,E=Symbol.for("PTR_IDENTIFIER"),_={},S=()=>String.fromCharCode(...q()),u=e=>e?.[E],q=function*(e=52){let t=0;for(;t++<e;){let r=Math.floor(Math.random()*31);yield 127+r+(r>141)+(r>156)}},R={is:Object.is,leq:(e,t)=>e==t,seq:(e,t)=>e===t,or:(e,t)=>e||t,and:(e,t)=>e&&t,xor:(e,t)=>e^t,sum:(e,t)=>e+t,sub:(e,t)=>e-t,mul:(e,t)=>e*t,div:(e,t)=>e/t,mod:(e,t)=>e%t},F=Object.assign({[Symbol.toPrimitive]([e],t){return typeof t=="string"?t==="string"&&f(e,x)?this.publish():e.toString():t===E},watch(e,t){return t&&e[2].set(t,[e[1].push(t)-1,!0]),this},abort(e,t){if(t){let r=e[2].get(t);r[1]=!1,delete e[1][r?.[0]]}return this},into([e],t=r=>r){let r=o=>{let s=t(o);return f(s,C)?(s.then(i=>n.$=i),void 0):n.$=s},n=g();return r(e),this.watch(r),n},until(e,t){return new C(r=>{let n=o=>(f(t,x)?t(o):o===t)?(this.abort(n),r(this)):0;this.watch(n)})},switch(){return this.$=!this.$,this},not(){return this.into(e=>!e)},bool(){return this.into(e=>!!e)},isit(e,t){return this.into(r=>r?e:t)},tick(){let e=!1;return this.into(()=>e=!e)},toString(e,t){let r=u(t),n=this.into(o=>o.toString(r?t.$:t));return r&&t.watch(o=>n.$=this.$.toString(o)),n},publish(e){let t=Symbol(e[3]);return _[t]=this,t},text(){let e=new Text(this.$);return this.watch(t=>e.textContent=t),[e]},timeout(e,t){let r=g(this.$),n;return this.watch(o=>{clearTimeout(n),n=setTimeout(()=>r.$=o,u(t)?t.$:t)}),r}},...Object.keys(R).map(e=>({[e](t,r){let n=u(r),o=R[e],s=this.into(i=>o(i,n?r.$:r));return n&&r.watch(i=>s.$=o(this.$,i)),s}}))),L=new WeakMap,G=(e,t)=>(...r)=>{let n=r.map((s,i)=>u(s)?s.watch(c=>(n[i]=c,o.$=e.$[t](...n))).$:s),o=e.into(s=>s[t](...n));return o},K=e=>function(t,r,n){let o=e[2];return(r||t!==e[0])&&(e[0]=t,e[1].forEach(s=>o.get(s)?.[1]?s(t):0)),n},Z=m(e=>m(t=>F[e].bind(L.get(t),t),!0)),B=hasOwnProperty.bind(F),g=(e,[t,r]=[])=>{let n=[],o=new WeakMap,s=Object.assign({name:"$",writable:!0},r),i=[e,n,o,M+s.name],c=K(i),h=new Proxy(Object.defineProperties(Object(function(...d){let[a]=i;return f(a,x)?a.apply(null,d):a}),{name:{value:s.name}}),{get(d,a,p){let[l]=i;return a==="$"?l:a==="refresh"?c.bind(null,l,!0,p):a==="constructor"||a===E?!0:a===Symbol.hasInstance?()=>!1:B(a)?Z(a)(i):f(l[a],x)?G(p,a):p.into(b=>b[a])},set(d,a,p){if(s.writable)if(a=="$"){let l=t?t(p):p;f(l,C)?l.then(c):c(l)}else i[0][a]=u(p)?p.watch(l=>i[0][a]=l).$:p;return!0}});return L.set(i,h),h},M;for(;(M=S())in globalThis;);Object.defineProperty(globalThis,M,{value:e=>_[e],configurable:!1,enumerable:!1});var Q=m(e=>{let t=S();return[e.join(t),new RegExp(t,"g")]},!0),X=(e,t)=>{let[r,n]=Q(e),o=t.map((c,h)=>u(c)?c.watch(()=>(o[h]=c.$,i.$=s())).$:c),s=(c=0)=>r.replaceAll(n,()=>o[c++]),i=g(s());return i},N={},gt=new Proxy((e,...t)=>(P(e)&&P(e?.raw)?X:g)(e,t),{get:(e,t)=>{if(t===Symbol.hasInstance)return u;if(t==="this")return;let r=N[t];return!r&&!f(globalThis[t],Function)&&(r=N[t]=g(globalThis[t]),$("resize",({target:n})=>r.$=n[t],globalThis)),r||J[t]}}),J=g(globalThis);var W=e=>e.prototype;var y=(e=36)=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(e);var{replaceWith:U}=W(Element),Y=Symbol.for("HTML_IDENTIFIER"),V=document.createDocumentFragment(),v={[Symbol.toPrimitive](e){return typeof e=="string"?[...this[Symbol.iterator]().map(t=>t.outerHTML)].join(""):e===Y},toString(){return this[Symbol.toPrimitive]("string")}},tt={get(e,t){let r=e[t];return f(r,Function)?r.bind(e):r},set(e,t,r){return console.log(t),t!=="id"&&I(null,e,{[t]:r}),!0}},et=$("input"),I=(e,t,r)=>Reflect.ownKeys(r).forEach(n=>{let o=r[n],s=typeof n;if(s=="symbol"){let i=globalThis[n.description.slice(0,52)]?.(n);if(!u(i))return;let c=i.$(o,t);if(c?.constructor!==Object)return;I(e,t,c)}else s=="string"&&(u(o)?(t[n]=o.watch(i=>t[n]=i).$,"\0value\0checked\0".includes(`\0${n}\0`)&&n in t&&et(({target:{[n]:i}})=>o.$="number\0range".includes(t.type)?Number(i):i,t)):t[n]=o,n=="id"&&!(o in e)&&(e[o]=new Proxy(t,tt)))}),z=(e,t)=>{if(t instanceof Promise){let r=Object.assign(document.createElement("div"),{hidden:!0});t.then(z.bind(null,r)),e.replaceWith(r)}else if(typeof t[Symbol.asyncIterator]=="function"){let r=document.createComment(""),n=document.createComment(""),o=document.createComment(""),s;(async()=>{for await(let i of t){let c=r.nextSibling;for(;c&&c!==n;){let h=c.nextSibling;c.remove(),c=h}s||=n.parentNode,s.insertBefore(o,n),o.replaceWith(...i)}r.remove(),n.remove()})(),e.replaceWith(r,n)}else U.apply(e,f(t,Array)?t.map(r=>[...r]).flat(1):t instanceof NodeList?t:u(t)?t.text():[new Text(t)])},rt=m(e=>{let t=e.join(""),r=0,n="t";for(;t.includes(n+=y()););t=e.join(n);let o=n.length,s=[...t.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${n}`,"g"))].map(({0:{length:h},index:d})=>d+h),i=[],c=document.createElement("div");return V.appendChild(c),c.innerHTML=t.replaceAll(n,(h,d)=>(i[r++]=s.includes(d+o))?n:`<br ${n}>`),h=>{let d=c.cloneNode(!0),a={};d.querySelectorAll(`[${n}]`).forEach((l,b)=>{let O=h[b];i[b]?I(a,l,O):z(l,O),l.removeAttribute(n)});let p=Object.assign(d.childNodes,v,{on(...l){return l.forEach(b=>b(a)),p}});return p}},!0),St=(e,...t)=>rt(e)(t);var w=(e,t)=>{let r=m(i=>g(e(i),void 0,{name:t?t(i):""})),n=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():r(c).publish()}}),o=g(i=>{let c={};return Reflect.ownKeys(i).forEach(h=>c[n[h]]=i[h]),c}),s=o.publish.bind(o);return n};var _t=w($,m(e=>"on."+e));var D=m(e=>{let t;for(;document.querySelector(`[${t=`h${y()}`}]`););return e.setAttribute(t,""),t},!0);var k=!1,T={},nt=/[A-Z]{1}/g,ot=m(e=>"-"+e.toLowerCase()),H=m(e=>e.replaceAll(nt,ot)),Gt=w(e=>(t,r)=>{let n=r.style,o=D(r),s=H(e);u(t)?n.setProperty(s,t.watch(i=>n.setProperty(s,i)).$):(k||(k=!0,queueMicrotask(()=>{document.head.append(Object.assign(document.createElement("style"),{textContent:Object.entries(T).map(([i,c])=>`[${i}]{${c}}`).join("")})),k=!1,T={}})),T[o]=(T[o]||"")+`${s}:${t};`)},m(e=>"css-"+H(e)));export{gt as $,Gt as css,St as h,$ as listen,_t as on};
