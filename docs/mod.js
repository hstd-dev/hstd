var C="\0",p=new WeakMap,g=function(t,e,r){C.includes(`\0${t}\0`)||(globalThis.addEventListener(t,n=>p.get(n.target)?.[t]?.forEach(o=>o(n)),{passive:!0}),C+=t+"\0"),p.has(r)||p.set(r,{}),(p.get(r)[t]||=[]).push(e)};var f=(t,e)=>t?.constructor===e,x=t=>Object.isFrozen(t)&&f(t,Array);var{Promise:P,Function:$}=globalThis,S=Symbol.for("PTR_IDENTIFIER"),h=t=>t?.[S],E=()=>String.fromCharCode(...z()),j={},z=function*(t=52){let e=0;for(;e++<t;){let r=Math.floor(Math.random()*31);yield 127+r+(r>141)+(r>156)}},R={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},_=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&f(t,$)?this.publish():t.toString():e===S},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let r=t[2].get(e);r[1]=!1,delete t[1][r?.[0]]}return this},into([t],e=r=>r){let r=o=>{let i=e(o);return f(i,P)?(i.then(c=>n.$=c),void 0):n.$=i},n=b();return r(t),this.watch(r),n},until(t,e){return new P(r=>{let n=o=>(f(e,$)?e(o):o===e)?(this.abort(n),r(this)):0;this.watch(n)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},isit(t,e){return this.into(r=>r?t:e)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let r=h(e),n=this.into(o=>o.toString(r?e.$:e));return r&&e.watch(o=>n.$=this.$.toString(o)),n},publish(t){let e=Symbol(t[3]);return j[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let r=b(this.$),n;return this.watch(o=>{clearTimeout(n),n=setTimeout(()=>r.$=o,h(e)?e.$:e)}),r}},...Object.keys(R).map(t=>({[t](e,r){let n=h(r),o=R[t],i=this.into(c=>o(c,n?r.$:r));return n&&r.watch(c=>i.$=o(this.$,c)),i}}))),b=(t,[e,r]=[])=>{let n=[],o=new WeakMap,i=Object.assign({name:"$",writable:!0},r),c=function(m,l,u){return(l||m!==s[0])&&(s[0]=m,n.forEach(a=>o.get(a)?.[1]?a(m):0)),u},s=[t,n,o,M+(r?.name||"")];return new Proxy(Object.defineProperties(Object(function(...m){let[l]=s;return f(l,$)?l.apply(null,m):l}),{name:{value:i.name}}),{get(m,l,u){let[a]=s;return l==="$"?a:l==="refresh"?c.bind(null,a,!0,u):l==="constructor"||l===S?!0:l===Symbol.hasInstance?()=>!1:_[l]?.bind?.(u,s)||(f(a[l],$)?function(...y){let T=y.map((d,L)=>h(d)?d.watch(W=>(T[L]=W,I.$=u.$[l](...T))).$:d),I=u.into(d=>d[l](...T));return I}:u.into(y=>y[l]))},set(m,l,u){if(i.writable)if(l=="$"){let a=e?e(u):u;f(a,P)?a.then(c):c(a)}else s[0][l]=h(u)?u.watch(a=>s[0][l]=a).$:u;return!0}})},M;for(;(M=E())in globalThis;);Object.defineProperty(globalThis,M,{value:t=>j[t],configurable:!1,enumerable:!1});var k=(t,e)=>{let r=E(),n=t.join(r),o=new RegExp(r,"g"),i=e.map((m,l)=>h(m)?m.watch(()=>(i[l]=m.$,s.$=c())).$:m),c=(m=0)=>n.replaceAll(o,()=>i[m++]),s=b(c());return s},A={},B="\0innerWidth\0innerHeight\0outerWidth\0outerHeight\0",st=new Proxy((t,...e)=>(x(t)&&x(t?.raw)?k:b)(t,e),{get:(t,e)=>{let r=A[e];return!r&&B.includes(`\0${e}\0`)&&(r=A[e]=b(globalThis[e]),g("resize",({target:n})=>r.$=n[e],globalThis)),r||D[e]}}),D=b(globalThis);var F=Symbol.for("HTML_IDENTIFIER"),O=new WeakMap,G=document.createDocumentFragment(),K={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===F},toString(){return this[Symbol.toPrimitive]("string")}},Z={get(t,e){let r=t[e];return f(r,Function)?r.bind(t):r}},H=(t,e)=>Reflect.ownKeys(e).forEach(q.bind(null,t,e)),q=function(t,e,r){let[n,o]=t,i=e[r],c=typeof r;if(c=="symbol"){let s=globalThis[r.description.slice(0,52)]?.(r);if(!h(s))return;let m=s.$(i,o);if(m?.constructor!==Object)return;H(t,m)}else c=="string"&&(h(i)?(o[r]=i.watch(s=>o[r]=s).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in o&&g("input",({target:{[r]:s}})=>i.$="number\0range".includes(o.type)?Number(s):s,o)):r=="id"&&!(i in n)?n[i]=new Proxy(o,Z):o[r]=i)},Q=function([t,e],r,n,o,i){let c=r[i];e[i]?H([n,o],c):o.replaceWith(...c[Symbol.toPrimitive]?.(F)?c:h(c)?c.text():[new Text(c)]),o.removeAttribute(t)},X=function(t,e){let r=t[2](),n={};return r.querySelectorAll(`[${t[0]}]`).forEach(Q.bind(null,t,e,n)),Object.assign(r.childNodes,K,{then(o){return o(n),this}})},at=(t,...e)=>{let r=O.get(t);if(!r){let n=t.join(""),o=0,i="t";for(;n.includes(i+=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)).toString(36)););n=t.join(i);let c=i.length,s=[...n.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${i}`,"g"))].map(({0:{length:u},index:a})=>a+u),m=[],l=document.createElement("div");G.appendChild(l),l.innerHTML=n.replaceAll(i,(u,a)=>(m[o++]=s.includes(a+c))?i:`<br ${i}>`),O.set(t,r=X.bind(null,[i,m,l.cloneNode.bind(l,!0)]))}return r(e)};var w=(t,e)=>{let r={},n=new Proxy({},{get(c,s){return s===Symbol.toPrimitive?i:s==="$"?i():(r[s]||=b(t.bind(null,s),void 0,{name:e?e(s):""})).publish()}}),o=b(c=>{let s={};return Reflect.ownKeys(c).forEach(m=>s[n[m]]=c[m]),s}),i=()=>o.publish();return n};var pt=w(g,t=>"on."+t);var J=/[A-Z]{1}/g,U={},Y=t=>U[t]||="-"+t.toLowerCase(),v={},N=t=>v[t]||=t.replaceAll(J,Y),Tt=w(function(t,e,{style:r}){let n=N(t);r.setProperty(n,h(e)?e.watch(o=>r.setProperty(n,o)).$:e)},t=>"css-"+N(t));export{st as $,Tt as css,at as h,pt as on};
