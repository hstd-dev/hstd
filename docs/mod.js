var g=(t,e=new WeakMap,r)=>n=>e.has(n)?e.get(n):(e.set(n,r=t(n)),r);var M="\0",R=g(()=>({})),d=function(t,e,r){M.includes(`\0${t}\0`)||(globalThis.addEventListener(t,n=>R(n.target)[t]?.forEach?.(o=>o(n)),{passive:!0}),M+=t+"\0"),(R(r)[t]||=[]).push(e)};var f=(t,e)=>t?.constructor===e,x=t=>Object.isFrozen(t)&&f(t,Array);var{Promise:P,Function:y}=globalThis,S=Symbol.for("PTR_IDENTIFIER"),F={},C=()=>String.fromCharCode(...N()),a=t=>t?.[S],N=function*(t=52){let e=0;for(;e++<t;){let r=Math.floor(Math.random()*31);yield 127+r+(r>141)+(r>156)}},A={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},_=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&f(t,y)?this.publish():t.toString():e===S},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let r=t[2].get(e);r[1]=!1,delete t[1][r?.[0]]}return this},into([t],e=r=>r){let r=o=>{let c=e(o);return f(c,P)?(c.then(s=>n.$=s),void 0):n.$=c},n=b();return r(t),this.watch(r),n},until(t,e){return new P(r=>{let n=o=>(f(e,y)?e(o):o===e)?(this.abort(n),r(this)):0;this.watch(n)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},isit(t,e){return this.into(r=>r?t:e)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let r=a(e),n=this.into(o=>o.toString(r?e.$:e));return r&&e.watch(o=>n.$=this.$.toString(o)),n},publish(t){let e=Symbol(t[3]);return F[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let r=b(this.$),n;return this.watch(o=>{clearTimeout(n),n=setTimeout(()=>r.$=o,a(e)?e.$:e)}),r}},...Object.keys(A).map(t=>({[t](e,r){let n=a(r),o=A[t],c=this.into(s=>o(s,n?r.$:r));return n&&r.watch(s=>c.$=o(this.$,s)),c}}))),b=(t,[e,r]=[])=>{let n=[],o=new WeakMap,c=Object.assign({name:"$",writable:!0},r),s=function(m,l,u){return(l||m!==i[0])&&(i[0]=m,n.forEach(h=>o.get(h)?.[1]?h(m):0)),u},i=[t,n,o,E+(r?.name||"")];return new Proxy(Object.defineProperties(Object(function(...m){let[l]=i;return f(l,y)?l.apply(null,m):l}),{name:{value:c.name}}),{get(m,l,u){let[h]=i;return l==="$"?h:l==="refresh"?s.bind(null,h,!0,u):l==="constructor"||l===S?!0:l===Symbol.hasInstance?()=>!1:_[l]?.bind?.(u,i)||(f(h[l],y)?function(...$){let w=$.map((p,L)=>a(p)?p.watch(k=>(w[L]=k,I.$=u.$[l](...w))).$:p),I=u.into(p=>p[l](...w));return I}:u.into($=>$[l]))},set(m,l,u){if(c.writable)if(l=="$"){let h=e?e(u):u;f(h,P)?h.then(s):s(h)}else i[0][l]=a(u)?u.watch(h=>i[0][l]=h).$:u;return!0}})},E;for(;(E=C())in globalThis;);Object.defineProperty(globalThis,E,{value:t=>F[t],configurable:!1,enumerable:!1});var z=g(t=>{let e=C();return[t.join(e),new RegExp(e,"g")]}),B=(t,e)=>{let[r,n]=z(t),o=e.map((i,m)=>a(i)?i.watch(()=>(o[m]=i.$,s.$=c())).$:i),c=(i=0)=>r.replaceAll(n,()=>o[i++]),s=b(c());return s},O={};var ut=new Proxy({},{get(t,e){}}),ht=new Proxy((t,...e)=>(x(t)&&x(t?.raw)?B:b)(t,e),{get:(t,e)=>{if(e===Symbol.hasInstance)return a;if(e==="this")return;let r=O[e];return!r&&!f(globalThis[e],Function)&&(r=O[e]=b(globalThis[e]),d("resize",({target:n})=>r.$=n[e],globalThis)),r||D[e]}}),D=b(globalThis);var j=Symbol.for("HTML_IDENTIFIER"),G=document.createDocumentFragment(),K={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===j},toString(){return this[Symbol.toPrimitive]("string")}},Z={get(t,e){let r=t[e];return f(r,Function)?r.bind(t):r}},W=(t,e)=>Reflect.ownKeys(e).forEach(q.bind(null,t,e)),q=function(t,e,r){let[n,o]=t,c=e[r],s=typeof r;if(s=="symbol"){let i=globalThis[r.description.slice(0,52)]?.(r);if(!a(i))return;let m=i.$(c,o);if(m?.constructor!==Object)return;W(t,m)}else s=="string"&&(a(c)?(o[r]=c.watch(i=>o[r]=i).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in o&&d("input",({target:{[r]:i}})=>c.$="number\0range".includes(o.type)?Number(i):i,o)):o[r]=c,r=="id"&&!(c in n)&&(n[c]=new Proxy(o,Z)))},Q=function([t,e],r,n,o,c){let s=r[c];e[c]?W([n,o],s):o.replaceWith(...s[Symbol.toPrimitive]?.(j)?s:a(s)?s.text():[new Text(s)]),o.removeAttribute(t)},X=function(t,e){return e(t),this},J=function(t,e){let r=t[2](),n={};return r.querySelectorAll(`[${t[0]}]`).forEach(Q.bind(null,t,e,n)),Object.assign(r.childNodes,K,{then:X.bind(null,n)})},U=g(t=>{let e=t.join(""),r=0,n="t";for(;e.includes(n+=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)).toString(36)););e=t.join(n);let o=n.length,c=[...e.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${n}`,"g"))].map(({0:{length:m},index:l})=>l+m),s=[],i=document.createElement("div");return G.appendChild(i),i.innerHTML=e.replaceAll(n,(m,l)=>(s[r++]=c.includes(l+o))?n:`<br ${n}>`),J.bind(null,[n,s,i.cloneNode.bind(i,!0)])}),yt=(t,...e)=>U(t)(e);var T=(t,e)=>{let r={},n=new Proxy({},{get(s,i){return i===Symbol.toPrimitive?c:i==="$"?c():(r[i]||=b(t.bind(null,i),void 0,{name:e?e(i):""})).publish()}}),o=b(s=>{let i={};return Reflect.ownKeys(s).forEach(m=>i[n[m]]=s[m]),i}),c=()=>o.publish();return n};var St=T(d,t=>"on."+t);var Y=/[A-Z]{1}/g,v={},V=t=>v[t]||="-"+t.toLowerCase(),tt={},H=t=>tt[t]||=t.replaceAll(Y,V),Mt=T(function(t,e,{style:r}){let n=H(t);r.setProperty(n,a(e)?e.watch(o=>r.setProperty(n,o)).$:e)},t=>"css-"+H(t));export{ht as $,Mt as css,yt as h,d as listen,St as on};
