var P={},L=function*(t=52){let e;for(let n=0;n<t;n++)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},j=()=>String.fromCharCode(...L()),T=Symbol.for("PTR_IDENTIFIER"),p=t=>t?.[T],x=(t,e)=>t?.constructor===e,E=t=>Object.isFrozen(t)&&Array.isArray(t),M={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},B=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===T},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=y(e(t));return this.watch(r=>n.$=e(r)),n},until(t,e){return new Promise(n=>{let r=c=>(typeof e=="function"?e(c):c===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=p(e),r=this.into(c=>c.toString(n?e.$:e));return n&&e.watch(c=>r.$=this.$.toString(c)),r},publish(t){let e=Symbol(t[3]);return P[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(M).map(t=>({[t](e,n){let r=p(n),c=M[t],f=this.into(a=>c(a,r?n.$:n));return r&&n.watch(a=>f.$=c(this.$,a)),f}}))),y=(t,e=r=>r,n={})=>{let r=[],c=new WeakMap,f=Object.assign({name:"$"},n),a=function(i,s,h){return(s||i!==o[0])&&(o[0]=i,r.forEach(m=>c.get(m)?.[1]?m(i):0)),h},o=[t,r,c,S+(n.name||""),a];return new Proxy(Object.defineProperties(Object(function(...i){let[s]=o;return x(s,Function)?s.apply(null,i):s}),{name:{value:f.name}}),{get(i,s,h){let[m]=o;return s==="$"?m:s==="refresh"?a.bind(null,m,!0,h):s==="constructor"||s===T?!0:s===Symbol.hasInstance?()=>!1:B[s]?.bind?.(h,o)||(x(m[s],Function)?function(...l){let u=l.map((d,g)=>p(d)?(d.watch(k=>(u[g]=k,b.$=h.$[s](...u))),d.$):d),b=h.into(d=>d[s](...u));return b}:h.into(l=>l[s]))},set(i,s,h){if(s=="$"){let m=e?e(h):h;x(m,Promise)?m.then(a):a(m)}return!0}})},F=(t,...e)=>{let n=j(),r=t.join(n),c=new RegExp(n,"g"),f=e.map((i,s)=>p(i)?(i.watch(()=>(f[s]=i.$,o.$=a())),i.$):i),a=(i=0)=>r.replaceAll(c,()=>f[i++]),o=y(a());return o},H=(t,...e)=>(E(t)&&E(t?.raw)?F:y).call(null,t,...e),S;for(;(S=j())in globalThis;);Object.defineProperty(globalThis,S,{value:t=>P[t],configurable:!1,enumerable:!1});var C=16,R=Symbol.for("HTML_IDENTIFIER"),N=function*(t=C){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},I=new WeakMap,W=document.createDocumentFragment(),z={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===R},toString(){return this[Symbol.toPrimitive]("string")}},D={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},O=(t,e)=>Reflect.ownKeys(e).forEach(t.bind(!1,e)),Z=(t,...e)=>{let n=I.get(t);if(!n){let o=t.join(""),i,s=0;for(;o.includes(i=String.fromCharCode(...N())););o=t.join(i);let h=[...o.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${i}`,"g"))].map(({0:{length:u},index:b})=>b+u),m=[],l=document.createElement("div");W.appendChild(l),l.innerHTML=o.replaceAll(i,(u,b)=>(m[s++]=h.includes(b+C))?i:`<br ${i}>`),I.set(t,n=()=>[l.cloneNode(!0),m,i])}let[r,c,f]=n(),a={};return r.querySelectorAll(`[${f}]`).forEach((o,i)=>{let s=e[i];if(c[i]){let h=function(m,l){let u=m[l],b=typeof l;if(b=="symbol"){let d=globalThis[l.description.slice(0,52)]?.(l);if(!p(d))return;let g=d.$(u,o);if(g?.constructor!==Object)return;O(h,g)}else if(b=="string")if(p(u))if("value\0checked".includes(l)&&l in o){o[l]=u.$;let d=g=>o[l]=g;u.watch(d),o.addEventListener("input",({target:{[l]:g}})=>{u.$="number\0range".includes(o.type)?Number(g):g},{passive:!0})}else o[l]=u.$,u.watch(d=>o[l]=d);else l=="id"&&!(u in a)?a[u]=new Proxy(o,D):o[l]=u};O(h,s)}else o.replaceWith(...s[Symbol.toPrimitive]?.(R)?s:p(s)?s.text():[new Text(s)]);o.removeAttribute(f)}),Object.assign(r.childNodes,z,{then(o){return o(a),this}})};var w=(t,e)=>{let n={},r=new Proxy({},{get(a,o){return o===Symbol.toPrimitive?f:o==="$"?f():(n[o]||=y(t.bind(null,o),void 0,{name:e?e(o):""})).publish()}}),c=y(a=>{let o={};return Object.keys(a).forEach(i=>o[r[i]]=a[i]),o}),f=()=>c.publish();return r};var A="\0",$=new WeakMap,G=w(function(t,e,n){A.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>$.get(r.target)?.[t]?.forEach(c=>c(r)),{passive:!0}),A+=t+"\0"),$.has(n)||$.set(n,{}),($.get(n)[t]||=[]).push(e)},t=>"on."+t);var K=/[A-Z]{1}/g,q={},v=t=>q[t]||="-"+t.toLowerCase(),J={},_=t=>J[t]||=t.replaceAll(K,v),Q=w(function(t,e,{style:n}){let r=_(t);n.setProperty(r,p(e)?(e.watch(c=>n.setProperty(r,c)),e.$):e)},t=>"css-"+_(t));export{H as $,Q as css,Z as h,G as on,w as prop};
