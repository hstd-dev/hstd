var M={},H=function*(t=52){let e,n=0;for(;n++<t;)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},j=()=>String.fromCharCode(...H()),w=Symbol.for("PTR_IDENTIFIER"),h=t=>t?.[w],$=(t,e)=>t?.constructor===e,E=t=>Object.isFrozen(t)&&Array.isArray(t),P={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},N=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===w},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=f(e(t));return this.watch(r=>n.$=e(r)),n},until(t,e){return new Promise(n=>{let r=o=>(typeof e=="function"?e(o):o===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=h(e),r=this.into(o=>o.toString(n?e.$:e));return n&&e.watch(o=>r.$=this.$.toString(o)),r},publish(t){let e=Symbol(t[3]);return M[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(P).map(t=>({[t](e,n){let r=h(n),o=P[t],s=this.into(c=>o(c,r?n.$:n));return r&&n.watch(c=>s.$=o(this.$,c)),s}}))),f=(t,[e,n]=[])=>{let r=[],o=new WeakMap,s=Object.assign({name:"$"},n),c=function(u,l,a){return(l||u!==i[0])&&(i[0]=u,r.forEach(m=>o.get(m)?.[1]?m(u):0)),a},i=[t,r,o,x+(n?.name||""),c];return new Proxy(Object.defineProperties(Object(function(...u){let[l]=i;return $(l,Function)?l.apply(null,u):l}),{name:{value:s.name}}),{get(u,l,a){let[m]=i;return l==="$"?m:l==="refresh"?c.bind(null,m,!0,a):l==="constructor"||l===w?!0:l===Symbol.hasInstance?()=>!1:N[l]?.bind?.(a,i)||($(m[l],Function)?function(...g){let y=g.map((d,k)=>h(d)?d.watch(F=>(y[k]=F,S.$=a.$[l](...y))).$:d),S=a.into(d=>d[l](...y));return S}:a.into(g=>g[l]))},set(u,l,a){if(l=="$"){let m=e?e(a):a;$(m,Promise)?m.then(c):c(m)}else i[0][l]=h(a)?a.watch(m=>i[0][l]=m).$:a;return!0}})},W=(t,e)=>{let n=j(),r=t.join(n),o=new RegExp(n,"g"),s=e.map((u,l)=>h(u)?u.watch(()=>(s[l]=u.$,i.$=c())).$:u),c=(u=0)=>r.replaceAll(o,()=>s[u++]),i=f(c());return i},z=(t,...e)=>(E(t)&&E(t?.raw)?W:f)(t,e),x;for(;(x=j())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>M[t],configurable:!1,enumerable:!1});var b=(t,e)=>{let n={},r=new Proxy({},{get(c,i){return i===Symbol.toPrimitive?s:i==="$"?s():(n[i]||=f(t.bind(null,i),void 0,{name:e?e(i):""})).publish()}}),o=f(c=>{let i={};return Object.keys(c).forEach(u=>i[r[u]]=c[u]),i}),s=()=>o.publish();return r};var I="\0",p=new WeakMap,T=function(t,e,n){I.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>p.get(r.target)?.[t]?.forEach(o=>o(r)),{passive:!0}),I+=t+"\0"),p.has(n)||p.set(n,{}),(p.get(n)[t]||=[]).push(e)},D=b(T,t=>"on."+t);var C=16,R=Symbol.for("HTML_IDENTIFIER"),B=function*(t=C){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},O=new WeakMap,Z=document.createDocumentFragment(),G={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===R},toString(){return this[Symbol.toPrimitive]("string")}},K={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},A=(t,e)=>Reflect.ownKeys(e).forEach(_.bind(null,t,e)),_=function(t,e,n){let[r,o]=t,s=e[n],c=typeof n;if(c=="symbol"){let i=globalThis[n.description.slice(0,52)]?.(n);if(!h(i))return;let u=i.$(s,o);if(u?.constructor!==Object)return;A(t,u)}else c=="string"&&(h(s)?(o[n]=s.watch(i=>o[n]=i).$,"\0value\0checked\0".includes(`\0${n}\0`)&&n in o&&T("input",({target:{[n]:i}})=>s.$="number\0range".includes(o.type)?Number(i):i,o)):n=="id"&&!(s in r)?r[s]=new Proxy(o,K):o[n]=s)},q=function([t,e],n,r,o,s){let c=n[s];e[s]?A([r,o],c):o.replaceWith(...c[Symbol.toPrimitive]?.(R)?c:h(c)?c.text():[new Text(c)]),o.removeAttribute(t)},Q=function(t,e){let n=t[2].cloneNode(!0),r={};return n.querySelectorAll(`[${t[0]}]`).forEach(q.bind(null,t,e,r)),Object.assign(n.childNodes,G,{then(o){return o(r),this}})},v=(t,...e)=>{let n=O.get(t);if(!n){let r=t.join(""),o=0,s;for(;r.includes(s=String.fromCharCode(...B())););r=t.join(s);let c=[...r.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${s}`,"g"))].map(({0:{length:l},index:a})=>a+l),i=[],u=document.createElement("div");Z.appendChild(u),u.innerHTML=r.replaceAll(s,(l,a)=>(i[o++]=c.includes(a+C))?s:`<br ${s}>`),O.set(t,n=Q.bind(null,[s,i,u]))}return n(e)};var J=/[A-Z]{1}/g,U={},X=t=>U[t]||="-"+t.toLowerCase(),Y={},L=t=>Y[t]||=t.replaceAll(J,X),V=b(function(t,e,{style:n}){let r=L(t);n.setProperty(r,h(e)?(e.watch(o=>n.setProperty(r,o)),e.$):e)},t=>"css-"+L(t));export{z as $,V as css,v as h,D as on,b as prop};
