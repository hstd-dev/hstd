var j=()=>String.fromCharCode(...H()),O={},H=function*(t=52){let e=0;for(;e++<t;){let n=Math.floor(Math.random()*31);yield 127+n+(n>141)+(n>156)}},x;for(;(x=j())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>O[t],configurable:!1,enumerable:!1});var{Promise:T,Function:p}=globalThis,E=Symbol.for("PTR_IDENTIFIER"),a=t=>t?.[E],f=(t,e)=>t?.constructor===e,M=t=>Object.isFrozen(t)&&f(t,Array),I={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},_=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&f(t,p)?this.publish():t.toString():e===E},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=o=>{let i=e(o);return f(i,T)?(i.then(c=>r.$=c),void 0):r.$=i},r=b();return n(t),this.watch(n),r},until(t,e){return new T(n=>{let r=o=>(f(e,p)?e(o):o===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=a(e),r=this.into(o=>o.toString(n?e.$:e));return n&&e.watch(o=>r.$=this.$.toString(o)),r},publish(t){let e=Symbol(t[3]);return O[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]},timeout(t,e){let n=b(this.$),r;return this.watch(o=>{clearTimeout(r),r=setTimeout(()=>n.$=o,a(e)?e.$:e)}),n}},...Object.keys(I).map(t=>({[t](e,n){let r=a(n),o=I[t],i=this.into(c=>o(c,r?n.$:n));return r&&n.watch(c=>i.$=o(this.$,c)),i}}))),b=(t,[e,n]=[])=>{let r=[],o=new WeakMap,i=Object.assign({name:"$"},n),c=function(u,l,m){return(l||u!==s[0])&&(s[0]=u,r.forEach(h=>o.get(h)?.[1]?h(u):0)),m},s=[t,r,o,x+(n?.name||"")];return new Proxy(Object.defineProperties(Object(function(...u){let[l]=s;return f(l,p)?l.apply(null,u):l}),{name:{value:i.name}}),{get(u,l,m){let[h]=s;return l==="$"?h:l==="refresh"?c.bind(null,h,!0,m):l==="constructor"||l===E?!0:l===Symbol.hasInstance?()=>!1:_[l]?.bind?.(m,s)||(f(h[l],p)?function(...y){let w=y.map((d,N)=>a(d)?d.watch(k=>(w[N]=k,P.$=m.$[l](...w))).$:d),P=m.into(d=>d[l](...w));return P}:m.into(y=>y[l]))},set(u,l,m){if(l=="$"){let h=e?e(m):m;f(h,T)?h.then(c):c(h)}else s[0][l]=a(m)?m.watch(h=>s[0][l]=h).$:m;return!0}})},B=(t,e)=>{let n=j(),r=t.join(n),o=new RegExp(n,"g"),i=e.map((u,l)=>a(u)?u.watch(()=>(i[l]=u.$,s.$=c())).$:u),c=(u=0)=>r.replaceAll(o,()=>i[u++]),s=b(c());return s},W=b(globalThis),z=new Proxy((t,...e)=>(M(t)&&M(t?.raw)?B:b)(t,e),{get:(t,e)=>W[e]});var g=(t,e)=>{let n={},r=new Proxy({},{get(c,s){return s===Symbol.toPrimitive?i:s==="$"?i():(n[s]||=b(t.bind(null,s),void 0,{name:e?e(s):""})).publish()}}),o=b(c=>{let s={};return Object.keys(c).forEach(u=>s[r[u]]=c[u]),s}),i=()=>o.publish();return r};var R="\0",$=new WeakMap,S=function(t,e,n){R.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>$.get(r.target)?.[t]?.forEach(o=>o(r)),{passive:!0}),R+=t+"\0"),$.has(n)||$.set(n,{}),($.get(n)[t]||=[]).push(e)},D=g(S,t=>"on."+t);var C=Symbol.for("HTML_IDENTIFIER"),A=new WeakMap,G=document.createDocumentFragment(),Z={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===C},toString(){return this[Symbol.toPrimitive]("string")}},K={get(t,e){let n=t[e];return f(n,Function)?n.bind(t):n}},F=(t,e)=>Reflect.ownKeys(e).forEach(q.bind(null,t,e)),q=function(t,e,n){let[r,o]=t,i=e[n],c=typeof n;if(c=="symbol"){let s=globalThis[n.description.slice(0,52)]?.(n);if(!a(s))return;let u=s.$(i,o);if(u?.constructor!==Object)return;F(t,u)}else c=="string"&&(a(i)?(o[n]=i.watch(s=>o[n]=s).$,"\0value\0checked\0".includes(`\0${n}\0`)&&n in o&&S("input",({target:{[n]:s}})=>i.$="number\0range".includes(o.type)?Number(s):s,o)):n=="id"&&!(i in r)?r[i]=new Proxy(o,K):o[n]=i)},Q=function([t,e],n,r,o,i){let c=n[i];e[i]?F([r,o],c):o.replaceWith(...c[Symbol.toPrimitive]?.(C)?c:a(c)?c.text():[new Text(c)]),o.removeAttribute(t)},X=function(t,e){let n=t[2](),r={};return n.querySelectorAll(`[${t[0]}]`).forEach(Q.bind(null,t,e,r)),Object.assign(n.childNodes,Z,{then(o){return o(r),this}})},J=(t,...e)=>{let n=A.get(t);if(!n){let r=t.join(""),o=0,i="t";for(;r.includes(i+=BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)).toString(36)););r=t.join(i);let c=i.length,s=[...r.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${i}`,"g"))].map(({0:{length:m},index:h})=>h+m),u=[],l=document.createElement("div");G.appendChild(l),l.innerHTML=r.replaceAll(i,(m,h)=>(u[o++]=s.includes(h+c))?i:`<br ${i}>`),A.set(t,n=X.bind(null,[i,u,l.cloneNode.bind(l,!0)]))}return n(e)};var U=/[A-Z]{1}/g,Y={},v=t=>Y[t]||="-"+t.toLowerCase(),V={},L=t=>V[t]||=t.replaceAll(U,v),tt=g(function(t,e,{style:n}){let r=L(t);n.setProperty(r,a(e)?e.watch(o=>n.setProperty(r,o)).$:e)},t=>"css-"+L(t));export{z as $,tt as css,J as h,D as on,g as prop};
