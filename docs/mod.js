var m=(e,t=!1)=>{let n=new(t?WeakMap:Map);return r=>{let o;return n.has(r)?n.get(r):(n.set(r,o=e(r)),o)}};var O="\0",_=m(()=>({}),!0),$=e=>(t,n)=>{O.includes(`\0${e}\0`)||(globalThis.addEventListener(e,r=>_(r.target)[e]?.forEach?.(o=>o(r)),{passive:!0}),O+=e+"\0"),(_(n)[e]||=[]).push(t)};var p=(e,t)=>e?.constructor===t,P=e=>Object.isFrozen(e)&&p(e,Array);var{Promise:C,Function:y}=globalThis,E=Symbol.for("PTR_IDENTIFIER"),F={},S=()=>String.fromCharCode(...q()),f=e=>e?.[E],q=function*(e=52){let t=0;for(;t++<e;){let n=Math.floor(Math.random()*31);yield 127+n+(n>141)+(n>156)}},j={is:Object.is,leq:(e,t)=>e==t,seq:(e,t)=>e===t,or:(e,t)=>e||t,and:(e,t)=>e&&t,xor:(e,t)=>e^t,sum:(e,t)=>e+t,sub:(e,t)=>e-t,mul:(e,t)=>e*t,div:(e,t)=>e/t,mod:(e,t)=>e%t},L=Object.assign({[Symbol.toPrimitive]([e],t){return typeof t=="string"?t==="string"&&p(e,y)?this.publish():e.toString():t===E},watch(e,t){return t&&e[2].set(t,[e[1].push(t)-1,!0]),this},abort(e,t){if(t){let n=e[2].get(t);n[1]=!1,delete e[1][n?.[0]]}return this},into([e],t=n=>n){let n=o=>{let s=t(o);return p(s,C)?(s.then(i=>r.$=i),void 0):r.$=s},r=g();return n(e),this.watch(n),r},until(e,t){return new C(n=>{let r=o=>(p(t,y)?t(o):o===t)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(e=>!e)},bool(){return this.into(e=>!!e)},isit(e,t){return this.into(n=>n?e:t)},tick(){let e=!1;return this.into(()=>e=!e)},toString(e,t){let n=f(t),r=this.into(o=>o.toString(n?t.$:t));return n&&t.watch(o=>r.$=this.$.toString(o)),r},publish(e){let t=Symbol(e[3]);return F[t]=this,t},text(){let e=new Text(this.$);return this.watch(t=>e.textContent=t),[e]},timeout(e,t){let n=g(this.$),r;return this.watch(o=>{clearTimeout(r),r=setTimeout(()=>n.$=o,f(t)?t.$:t)}),n},from(e,t){let n=!0;return t(r=>n?this.$=r:r,r=>n=r),this}},...Object.keys(j).map(e=>({[e](t,n){let r=f(n),o=j[e],s=this.into(i=>o(i,r?n.$:n));return r&&n.watch(i=>s.$=o(this.$,i)),s}}))),B=new WeakMap,H=(e,t)=>(...n)=>{let r=n.map((s,i)=>f(s)?s.watch(c=>(r[i]=c,o.$=e.$[t](...r))).$:s),o=e.into(s=>s[t](...r));return o},v=e=>function(t,n,r){let o=e[2];return(n||t!==e[0])&&(e[0]=t,e[1].forEach(s=>o.get(s)?.[1]?s(t):0)),r},G=m(e=>m(t=>L[e].bind(B.get(t),t),!0)),Z=hasOwnProperty.bind(L),g=(e,[t,n]=[])=>{let r=[],o=new WeakMap,s=Object.assign({name:"$",writable:!0},n),i=[e,r,o,M+s.name],c=v(i),u=new Proxy(Object.defineProperties(Object(function(...l){let[a]=i;return p(a,y)?a.apply(null,l):a}),{name:{value:s.name}}),{get(l,a,d){let[h]=i;return a==="$"?h:a==="refresh"?c.bind(null,h,!0,d):a==="constructor"?!0:a===Symbol.asyncIterator?!1:a===E?!0:a===Symbol.hasInstance?()=>!1:Z(a)?G(a)(i):p(h[a],y)?H(d,a):d.into(b=>b[a])},set(l,a,d){if(s.writable)if(a=="$"){let h=t?t(d):d;p(h,C)?h.then(c):c(h)}else i[0][a]=f(d)?d.watch(h=>i[0][a]=h).$:d;return!0}});return B.set(i,u),u},M;for(;(M=S())in globalThis;);Object.defineProperty(globalThis,M,{value:e=>F[e],configurable:!1,enumerable:!1});var K=m(e=>{let t=S();return[e.join(t),new RegExp(t,"g")]},!0),X=(e,t)=>{let[n,r]=K(e),o=t.map((c,u)=>f(c)?c.watch(()=>(o[u]=c.$,i.$=s())).$:c),s=(c=0)=>n.replaceAll(r,()=>o[c++]),i=g(s());return i},N={},gt=new Proxy((e,...t)=>(P(e)&&P(e?.raw)?X:g)(e,t),{get:(e,t)=>{if(t===Symbol.hasInstance)return f;if(t==="this")return;let n=N[t];return!n&&!p(globalThis[t],Function)&&(n=N[t]=g(globalThis[t]),$("resize",({target:r})=>n.$=r[t],globalThis)),n||Q[t]}}),Q=g(globalThis);var D=e=>e.prototype;var x=(e=36)=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(e);var{replaceWith:Y}=D(Element),J=Symbol.for("HTML_IDENTIFIER"),U=document.createDocumentFragment(),V={[Symbol.toPrimitive](e){return typeof e=="string"?[...this[Symbol.iterator]().map(t=>t.outerHTML)].join(""):e===J},toString(){return this[Symbol.toPrimitive]("string")}},tt={get(e,t){let n=e[t];return p(n,Function)?n.bind(e):n},set(e,t,n){return console.log(t),t!=="id"&&R(null,e,{[t]:n}),!0}},et=$("input"),R=(e,t,n)=>Reflect.ownKeys(n).forEach(r=>{let o=n[r],s=typeof r;if(s=="symbol"){let i=globalThis[r.description.slice(0,52)]?.(r);if(!f(i))return;let c=i.$(o,t);if(c?.constructor!==Object)return;R(e,t,c)}else s=="string"&&(f(o)?(t[r]=o.watch(i=>t[r]=i).$,"\0value\0checked\0".includes(`\0${r}\0`)&&r in t&&et(({target:{[r]:i}})=>o.$="number\0range".includes(t.type)?Number(i):i,t)):t[r]=o,r=="id"&&!(o in e)&&(e[o]=new Proxy(t,tt)))}),I=(e,t)=>{if(t instanceof Promise){let n=Object.assign(document.createElement("div"),{hidden:!0});t.then(I.bind(null,n)),e.replaceWith(n)}else if(typeof t[Symbol.asyncIterator]=="function"){let n=document.createComment(""),r=document.createComment(""),o=Object.assign(document.createElement("div"),{hidden:!0}),s=!0,i=!0,c;(async()=>{for await(let u of t){if(s&&u==="append"){i=!1;continue}if(s=!1,i){let l=n.nextSibling;for(;l&&l!==r;){let a=l.nextSibling;l.remove(),l=a}}(c||=r.parentNode).insertBefore(o,r),I(o,u)}n.remove(),r.remove()})(),e.replaceWith(n,r)}else Y.apply(e,p(t,Array)?t.map(n=>[...n]).flat(1):t instanceof NodeList?t:f(t)?t.text():[new Text(t)])},rt=m(e=>{let t=e.join(""),n=0,r="t";for(;t.includes(r+=x()););t=e.join(r);let o=r.length,s=[...t.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${r}`,"g"))].map(({0:{length:u},index:l})=>l+u),i=[],c=document.createElement("div");return U.appendChild(c),c.innerHTML=t.replaceAll(r,(u,l)=>(i[n++]=s.includes(l+o))?r:`<br ${r}>`),u=>{let l=c.cloneNode(!0),a={};l.querySelectorAll(`[${r}]`).forEach((h,b)=>{let A=u[b];i[b]?R(a,h,A):I(h,A),h.removeAttribute(r)});let d=Object.assign(l.childNodes,V,{on(...h){return h.forEach(b=>b(a)),d}});return d}},!0),St=(e,...t)=>rt(e)(t);var w=(e,t)=>{let n=m(i=>g(e(i),void 0,{name:t?t(i):""})),r=new Proxy({},{get(i,c){return c===Symbol.toPrimitive?s:c==="$"?s():n(c).publish()}}),o=g(i=>Reflect.ownKeys(i).reduce((c,u)=>(c[r[u]]=i[u],c),{})),s=o.publish.bind(o);return r};var jt=w($,m(e=>"on."+e));var W=m(e=>{let t;for(;document.querySelector(`[${t=`h${x()}`}]`););return e.setAttribute(t,""),t},!0);var k=!1,T={},nt=/[A-Z]{1}/g,ot=m(e=>"-"+e.toLowerCase()),z=m(e=>e.replaceAll(nt,ot)),Ht=w(e=>(t,n)=>{let r=n.style,o=W(n),s=z(e);f(t)?r.setProperty(s,t.watch(i=>r.setProperty(s,i)).$):(k||(k=!0,queueMicrotask(()=>{document.head.append(Object.assign(document.createElement("style"),{textContent:Object.entries(T).map(([i,c])=>`[${i}]{${c}}`).join("")})),k=!1,T={}})),T[o]=(T[o]||"")+`${s}:${t};`)},m(e=>"css-"+z(e)));export{gt as $,Ht as css,St as h,$ as listen,jt as on};
