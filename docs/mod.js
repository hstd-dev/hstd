var M={},F=function*(t=52){let e=0;for(;e++<t;){let n=Math.floor(Math.random()*31);yield 127+n+(n>141)+(n>156)}},I=()=>String.fromCharCode(...F()),w=Symbol.for("PTR_IDENTIFIER"),h=t=>t?.[w],$=(t,e)=>t?.constructor===e,S=t=>Object.isFrozen(t)&&Array.isArray(t),P={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},k=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===w},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=f(e(t));return this.watch(r=>n.$=e(r)),n},until(t,e){return new Promise(n=>{let r=o=>(typeof e=="function"?e(o):o===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=h(e),r=this.into(o=>o.toString(n?e.$:e));return n&&e.watch(o=>r.$=this.$.toString(o)),r},publish(t){let e=Symbol(t[3]);return M[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(P).map(t=>({[t](e,n){let r=h(n),o=P[t],i=this.into(l=>o(l,r?n.$:n));return r&&n.watch(l=>i.$=o(this.$,l)),i}}))),f=(t,[e,n]=[])=>{let r=[],o=new WeakMap,i=Object.assign({name:"$"},n),l=function(u,c,a){return(c||u!==s[0])&&(s[0]=u,r.forEach(m=>o.get(m)?.[1]?m(u):0)),a},s=[t,r,o,x+(n?.name||""),l];return new Proxy(Object.defineProperties(Object(function(...u){let[c]=s;return $(c,Function)?c.apply(null,u):c}),{name:{value:i.name}}),{get(u,c,a){let[m]=s,Y=typeof c;return c==="$"?m:c==="refresh"?l.bind(null,m,!0,a):c==="constructor"||c===w?!0:c===Symbol.hasInstance?()=>!1:k[c]?.bind?.(a,s)||($(m[c],Function)?function(...g){let y=g.map((b,L)=>h(b)?b.watch(N=>(y[L]=N,E.$=a.$[c](...y))).$:b),E=a.into(b=>b[c](...y));return E}:a.into(g=>g[c]))},set(u,c,a){if(c=="$"){let m=e?e(a):a;$(m,Promise)?m.then(l):l(m)}else s[0][c]=h(a)?a.watch(m=>s[0][c]=m).$:a;return!0}})},H=(t,e)=>{let n=I(),r=t.join(n),o=new RegExp(n,"g"),i=e.map((u,c)=>h(u)?u.watch(()=>(i[c]=u.$,s.$=l())).$:u),l=(u=0)=>r.replaceAll(o,()=>i[u++]),s=f(l());return s},W=(t,...e)=>(S(t)&&S(t?.raw)?H:f)(t,e),x;for(;(x=I())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>M[t],configurable:!1,enumerable:!1});var d=(t,e)=>{let n={},r=new Proxy({},{get(l,s){return s===Symbol.toPrimitive?i:s==="$"?i():(n[s]||=f(t.bind(null,s),void 0,{name:e?e(s):""})).publish()}}),o=f(l=>{let s={};return Object.keys(l).forEach(u=>s[r[u]]=l[u]),s}),i=()=>o.publish();return r};var j="\0",p=new WeakMap,T=function(t,e,n){j.includes(`\0${t}\0`)||(globalThis.addEventListener(t,r=>p.get(r.target)?.[t]?.forEach(o=>o(r)),{passive:!0}),j+=t+"\0"),p.has(n)||p.set(n,{}),(p.get(n)[t]||=[]).push(e)},z=d(T,t=>"on."+t);var O=Symbol.for("HTML_IDENTIFIER"),A=new WeakMap,B=document.createDocumentFragment(),D={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===O},toString(){return this[Symbol.toPrimitive]("string")}},_={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},R=(t,e)=>Reflect.ownKeys(e).forEach(G.bind(null,t,e)),G=function(t,e,n){let[r,o]=t,i=e[n],l=typeof n;if(l=="symbol"){let s=globalThis[n.description.slice(0,52)]?.(n);if(!h(s))return;let u=s.$(i,o);if(u?.constructor!==Object)return;R(t,u)}else l=="string"&&(h(i)?(o[n]=i.watch(s=>o[n]=s).$,"\0value\0checked\0".includes(`\0${n}\0`)&&n in o&&T("input",({target:{[n]:s}})=>i.$="number\0range".includes(o.type)?Number(s):s,o)):n=="id"&&!(i in r)?r[i]=new Proxy(o,_):o[n]=i)},Z=function([t,e],n,r,o,i){let l=n[i];e[i]?R([r,o],l):o.replaceWith(...l[Symbol.toPrimitive]?.(O)?l:h(l)?l.text():[new Text(l)]),o.removeAttribute(t)},K=function(t,e){let n=t[2](),r={};return n.querySelectorAll(`[${t[0]}]`).forEach(Z.bind(null,t,e,r)),Object.assign(n.childNodes,D,{then(o){return o(r),this}})},q=(t,...e)=>{let n=A.get(t);if(!n){let r=t.join(""),o=0,i;for(;r.includes(i="t"+(BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))**8n).toString(36)););r=t.join(i);let l=i.length,s=[...r.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${i}`,"g"))].map(({0:{length:a},index:m})=>m+a),u=[],c=document.createElement("div");B.appendChild(c),c.innerHTML=r.replaceAll(i,(a,m)=>(u[o++]=s.includes(m+l))?i:`<br ${i}>`),A.set(t,n=K.bind(null,[i,u,c.cloneNode.bind(c,!0)]))}return n(e)};var Q=/[A-Z]{1}/g,X={},v=t=>X[t]||="-"+t.toLowerCase(),J={},C=t=>J[t]||=t.replaceAll(Q,v),U=d(function(t,e,{style:n}){let r=C(t);n.setProperty(r,h(e)?e.watch(o=>n.setProperty(r,o)).$:e)},t=>"css-"+C(t));export{W as $,U as css,q as h,z as on,d as prop};
