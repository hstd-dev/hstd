var j={},B=function*(t=52){let e;for(let n=0;n<t;n++)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},M=()=>String.fromCharCode(...B()),w=Symbol.for("PTR_IDENTIFIER"),E={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},H=Object.assign({[Symbol.toPrimitive](t,e){return e==="string"?this.publish():e===w},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=T(e(t));return this.watch(r=>n.$=e(r)),n},until(t,e){return new Promise(n=>{let r=l=>(typeof e=="function"?e(l):l===e)?(this.abort(r),n(this)):0;this.watch(r)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},toString(t,e){let n=g(e),r=this.into(l=>l.toString(n?e.$:e));return n&&e.watch(l=>r.$=this.$.toString(l)),r},publish(t){let e=Symbol(t[3]);return j[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(E).map(t=>({[t](e,n){let r=g(n),l=E[t],f=this.into(u=>l(u,r?n.$:n));return r&&n.watch(u=>f.$=l(this.$,u)),f}}))),g=t=>t?.[w],T=(t,e=r=>r,n={})=>{let r=[],l=new WeakMap,f=Object.assign({name:"$"},n),u=function(s,i,d){return(i||s!==o[0])&&(o[0]=s,r.forEach(h=>l.get(h)?.[1]?h(s):0)),d},o=[t,r,l,x+(n.name||"")];return new Proxy(Object.defineProperties(Object(function(...s){let[i]=o;return typeof i=="function"?i.apply(null,s):i}),{name:{value:f.name}}),{get(s,i,d){let[h]=o;return i==="$"?h:i==="refresh"?u.bind(null,h,!0,d):i===w?!0:H[i]?.bind?.(d,o)||(typeof h[i]=="function"?function(...c){let a=c.map((m,b)=>g(m)?(m.watch(k=>(a[b]=k,p.$=d.$[i](...a))),m.$):m),p=d.into(m=>m[i](...a));return p}:d.into(c=>c[i]))},set(s,i,d){if(i=="$"){let h=e(d);h instanceof Promise?h.then(u):u(h)}return!0}})},S=t=>Object.isFrozen(t)&&Array.isArray(t),W=(t,...e)=>{let n=M(),r=t.join(n),l=new RegExp(n,"g"),f=e.map((s,i)=>g(s)?(s.watch(()=>(f[i]=s.$,o.$=u())),s.$):s),u=(s=0)=>r.replaceAll(l,()=>f[s++]),o=T(u());return o},y=(...t)=>(S(t[0])&&S(t[0]?.raw)?W:T).apply(null,t),x;for(;(x=M())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>j[t],configurable:!1,enumerable:!1});var P=16,_=Symbol.for("HTML_IDENTIFIER"),D=function*(t=P){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},O=new WeakMap,z=document.createDocumentFragment(),F={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===_},toString(){return this[Symbol.toPrimitive]("string")}},Z={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},C=(t,e)=>Reflect.ownKeys(e).forEach(t.bind(!1,e)),v=(t,...e)=>{let n=O.get(t);if(!n){let o=t.join(""),s,i=0;for(;o.includes(s=String.fromCharCode(...D())););o=t.join(s);let d=[...o.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${s}`,"g"))].map(({0:{length:a},index:p})=>p+a),h=[],c=document.createElement("div");z.appendChild(c),c.innerHTML=o.replaceAll(s,(a,p)=>(h[i++]=d.includes(p+P))?s:`<br ${s}>`),O.set(t,n=()=>[c.cloneNode(!0),h,s])}let[r,l,f]=n(),u={};return r.querySelectorAll(`[${f}]`).forEach((o,s)=>{let i=e[s];if(l[s]){let d=function(h,c){let a=h[c],p=typeof c;if(p=="symbol"){let m=globalThis[c.description.slice(0,52)]?.(c);if(!g(m))return;let b=m.$(a,o);if(b?.constructor!==Object)return;C(d,b)}else if(p=="string")if(g(a))if("value\0checked".includes(c)&&c in o){o[c]=a.$;let m=b=>o[c]=b;a.watch(m),o.addEventListener("input",({target:{[c]:b}})=>{a.$="number\0range".includes(o.type)?Number(b):b},{passive:!0})}else o[c]=a.$,a.watch(m=>o[c]=m);else c=="id"&&!(a in u)?u[a]=new Proxy(o,Z):o[c]=a};C(d,i)}else o.replaceWith(...i[Symbol.toPrimitive]?.(_)?i:g(i)?i.text():[new Text(i)]);o.removeAttribute(f)}),Object.assign(r.childNodes,F,{then(o){return o(u),this}})};var I="",G={},K=y((t,e)=>Object.keys(t).forEach(n=>e.addEventListener(n,t[n],{passive:!0}))),$=new WeakMap,R=()=>K.publish(),nt=new Proxy({},{get(t,e){return e===Symbol.toPrimitive?R:e==="$"?R():(G[e]||=y((n,r)=>{I.includes(e)||(globalThis.addEventListener(e,l=>$.get(l.target)?.[e]?.forEach?.(f=>f(l)),{passive:!0}),I+=e+"\0"),typeof n=="object"&&(n=n.fn),$.has(r)||$.set(r,{}),($.get(r)[e]||=[]).push(n)},void 0,{name:"on."+e})).publish()}});var N={},V={},q=/[A-Z]{1}/g,J={},Q=t=>J[t]||="-"+t.toLowerCase(),L=t=>V[t]||=t.replaceAll(q,Q),U=y((t,e)=>e.style.cssText=Object.keys(t).map(n=>`${L(n)}:${t[n]};`).join("")),A=()=>U.publish(),rt=new Proxy({},{get(t,e){return e===Symbol.toPrimitive?A:e==="$"?A():(N[e]||=y((n,r)=>{r.style[L(e)]=n})).publish()}});export{y as $,rt as css,v as h,g as isPtr,nt as on};
