var M={},_=function*(t=52){let e;for(let n=0;n<t;n++)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},j=()=>String.fromCharCode(..._()),x=Symbol.for("PTR_IDENTIFIER"),E={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},k=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===x},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=y(e(t));return this.watch(s=>n.$=e(s)),n},until(t,e){return new Promise(n=>{let s=c=>(typeof e=="function"?e(c):c===e)?(this.abort(s),n(this)):0;this.watch(s)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=p(e),s=this.into(c=>c.toString(n?e.$:e));return n&&e.watch(c=>s.$=this.$.toString(c)),s},publish(t){let e=Symbol(t[3]);return M[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(E).map(t=>({[t](e,n){let s=p(n),c=E[t],d=this.into(a=>c(a,s?n.$:n));return s&&n.watch(a=>d.$=c(this.$,a)),d}}))),p=t=>t?.[x],y=(t,e=s=>s,n={})=>{let s=[],c=new WeakMap,d=Object.assign({name:"$"},n),a=function(o,r,u){return(r||o!==i[0])&&(i[0]=o,s.forEach(m=>c.get(m)?.[1]?m(o):0)),u},i=[t,s,c,T+(n.name||""),a];return new Proxy(Object.defineProperties(Object(function(...o){let[r]=i;return typeof r=="function"?r.apply(null,o):r}),{name:{value:d.name}}),{get(o,r,u){let[m]=i;return r==="$"?m:r==="refresh"?a.bind(null,m,!0,u):r===x?!0:k[r]?.bind?.(u,i)||(typeof m[r]=="function"?function(...l){let h=l.map((f,g)=>p(f)?(f.watch(C=>(h[g]=C,b.$=u.$[r](...h))),f.$):f),b=u.into(f=>f[r](...h));return b}:u.into(l=>l[r]))},set(o,r,u){if(r=="$"){let m=e?e(u):u;m instanceof Promise?m.then(a):a(m)}return!0}})},S=t=>Object.isFrozen(t)&&Array.isArray(t),L=(t,...e)=>{let n=j(),s=t.join(n),c=new RegExp(n,"g"),d=e.map((o,r)=>p(o)?(o.watch(()=>(d[r]=o.$,i.$=a())),o.$):o),a=(o=0)=>s.replaceAll(c,()=>d[o++]),i=y(a());return i},H=(...t)=>(S(t[0])&&S(t[0]?.raw)?L:y).apply(null,t),T;for(;(T=j())in globalThis;);Object.defineProperty(globalThis,T,{value:t=>M[t],configurable:!1,enumerable:!1});var I=16,R=Symbol.for("HTML_IDENTIFIER"),N=function*(t=I){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},O=new WeakMap,W=document.createDocumentFragment(),B={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===R},toString(){return this[Symbol.toPrimitive]("string")}},D={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},P=(t,e)=>Reflect.ownKeys(e).forEach(t.bind(!1,e)),z=(t,...e)=>{let n=O.get(t);if(!n){let i=t.join(""),o,r=0;for(;i.includes(o=String.fromCharCode(...N())););i=t.join(o);let u=[...i.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${o}`,"g"))].map(({0:{length:h},index:b})=>b+h),m=[],l=document.createElement("div");W.appendChild(l),l.innerHTML=i.replaceAll(o,(h,b)=>(m[r++]=u.includes(b+I))?o:`<br ${o}>`),O.set(t,n=()=>[l.cloneNode(!0),m,o])}let[s,c,d]=n(),a={};return s.querySelectorAll(`[${d}]`).forEach((i,o)=>{let r=e[o];if(c[o]){let u=function(m,l){let h=m[l],b=typeof l;if(b=="symbol"){let f=globalThis[l.description.slice(0,52)]?.(l);if(!p(f))return;let g=f.$(h,i);if(g?.constructor!==Object)return;P(u,g)}else if(b=="string")if(p(h))if("value\0checked".includes(l)&&l in i){i[l]=h.$;let f=g=>i[l]=g;h.watch(f),i.addEventListener("input",({target:{[l]:g}})=>{h.$="number\0range".includes(i.type)?Number(g):g},{passive:!0})}else i[l]=h.$,h.watch(f=>i[l]=f);else l=="id"&&!(h in a)?a[h]=new Proxy(i,D):i[l]=h};P(u,r)}else i.replaceWith(...r[Symbol.toPrimitive]?.(R)?r:p(r)?r.text():[new Text(r)]);i.removeAttribute(d)}),Object.assign(s.childNodes,B,{then(i){return i(a),this}})};var w=(t,e,n)=>{let s={},c=new Proxy({},{get(i,o){return o===Symbol.toPrimitive?a:o==="$"?a():(s[o]||=y(t.bind(null,o),void 0,{name:e(o)})).publish()}}),d=y(i=>Object.fromEntries(Object.entries(i).map(([o,r])=>[c[o],r]))),a=()=>d.publish();return c};var A="\0",$=new WeakMap,F=w(function(t,e,n){A.includes(`\0${t}\0`)||(globalThis.addEventListener(t,s=>$.get(s.target)?.[t]?.forEach(c=>c(s)),{passive:!0}),A+=t+"\0"),$.has(n)||$.set(n,{}),($.get(n)[t]||=[]).push(e)},t=>"on."+t);var Z={},G=/[A-Z]{1}/g,K={},q=t=>K[t]||="-"+t.toLowerCase(),v=w(function(t,e,n){n.style[t]=p(e)?(e.watch(s=>n.style[t]=s),e.$):e},t=>"css-"+(Z[t]||=t.replaceAll(G,q)));export{H as $,v as css,z as h,F as on,w as prop};
