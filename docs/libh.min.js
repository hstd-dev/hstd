var M=Symbol.for("PTR_IDENTIFIER"),k={into(e){let t=T(e(this.$),void 0),n=this;return this.watch(c=>t.$=e(c)),Object.assign(t,{parent:n})},refresh(){this.$=this.$}},E=({prototype:e},t={})=>Object.assign(t,...Reflect.ownKeys(e).map(n=>n!="constructor"&&typeof e[n]=="function"?{[n](...c){let l=c.map((i,m)=>y(i)?(i.watch(r=>{l[m]=r,this.refresh()}),i.$):i);return this.into(i=>i[n].apply(i,l))}}:!1)),W={boolean:E(Boolean,{switch(){this.$=!this.$},branch(e,t){return this.into(n=>n?e:t)}}),number:E(Number),string:E(String)},F=e=>e,H=function*(e=52){let t;for(let n=0;n<e;n++)t=Math.floor(Math.random()*31),yield 127+t+(t>141)+(t>156)},w={},y=e=>!!e?.[Symbol.toPrimitive]?.(M);var v=e=>{let t={};return new Proxy(e,{get(n,c){return t[c]||=T("")},set(n,c,l){y(l)?l.watch(i=>n[c]=i):n[c]=l}})},T=(e,t=F,n)=>{let c=S+(n?.name||""),l=Symbol(c),i=typeof e,m=o=>f.get(o)?void 0:o(e),r=o=>{if(typeof o!==i)throw new TypeError(`Cannot set ${typeof o} value to ${i} pointer`);e=o,h.forEach(m)},h=[],d=new WeakMap,f=new WeakMap;return w[l]=Object.assign({[Symbol.toPrimitive](o){return typeof o=="symbol"?o===M:i=="function"&&o=="string"?l:e},publish(){let o=Symbol(c);return w[o]=this,o},watch(o,s){return d.set(o,{index:h.push(o)-1,timeout:s}),this},ignore:{set(o){f.set(o,!1)},delete(o){f.set(o,!0)}},abort(o){delete h[d.get(o).index||-1]},until(o){let s;return new Promise(a=>this.watch(s=p=>{(typeof o=="function"?o(p):p===o)&&(this.abort(s),a(p))}))},get $(){return e},set $(o){(o=t(o))instanceof Promise?o.then(r):r(o)},get type(){return i},get length(){return this.into(o=>String(o).length)},text(){let o=new Text(this.$);return this.watch(s=>o.textContent=s),[o]}},k,W[i])},B=(e,t)=>{let n=[],c=T(n.join(""));return e.forEach((l,i)=>n[i*2]=l),t.forEach((l,i)=>{let m=i*2+1;n[m]=y(l)?(l.watch(r=>{n[m]=r,c.$=n.join("")}),l.$):String(l)}),c},j=e=>Array.isArray(e)&&Object.isFrozen(e),g=(e,...t)=>j(e)&&j(e.raw)?B(e,t):"function object".includes(typeof x)?v(e):T(e,...t),S;for(;(S=String.fromCharCode(...H()))in globalThis;);Object.defineProperty(globalThis,S,{value:e=>w[e],configurable:!1,enumerable:!1});var C=16,R=Symbol.for("HTML_IDENTIFIER"),D=function*(e=C){for(let t=0;t<e;t++)yield Math.floor(Math.random()*26)+97},P=new WeakMap,N=document.createDocumentFragment(),z={[Symbol.toPrimitive](e){return typeof e=="string"?[...this[Symbol.iterator]().map(t=>t.outerHTML)].join(""):e===R},toString(){return this[Symbol.toPrimitive]("string")}},K={get(e,t){let n=e[t];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(e):n}},I=(e,t)=>Reflect.ownKeys(t).forEach(e.bind(!1,t)),te=(e,...t)=>{let n=P.get(e);if(!n){let r=e.join(""),h,d=0;for(;r.includes(h=String.fromCharCode(...D())););r=e.join(h);let f=[...r.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${h}`,"g"))].map(({0:{length:a},index:p})=>p+a),o=[],s=document.createElement("div");N.appendChild(s),s.innerHTML=r.replaceAll(h,(a,p)=>(o[d++]=f.includes(p+C))?h:`<br ${h}>`),P.set(e,n=()=>[s.cloneNode(!0),o,h])}let[c,l,i]=n(),m={};return c.querySelectorAll(`[${i}]`).forEach((r,h)=>{let d=t[h];if(l[h]){let f=function(o,s){let a=o[s],p=typeof s;if(p=="symbol"){let u=globalThis[s.description.slice(0,52)]?.(s);if(!y(u))return;let b=u.$(a,r);if(b?.constructor!==Object)return;I(f,b)}else if(p=="string")if(y(a))if("value\0checked".includes(s)&&s in r){r[s]=a.$;let u=b=>r[s]=b;a.watch(u),r.addEventListener("input",({target:{[s]:b}})=>{a.ignore.set(u),a.$="number\0range".includes(r.type)?Number(b):b,a.ignore.delete(u)},{passive:!0})}else r[s]=a.$,a.watch(u=>r[s]=u);else s=="id"&&!(a in m)?m[a]=new Proxy(r,K):r[s]=a};I(f,d)}else r.replaceWith(...d[Symbol.toPrimitive]?.(R)?d:y(d)?d.text():[new Text(d)]);r.removeAttribute(i)}),Object.assign(c.childNodes,z,{then(r){return r(m),this}})};var A="",Z={},G=g((e,t)=>Object.keys(e).forEach(n=>t.addEventListener(n,e[n],{passive:!0}))),$=new WeakMap,L=()=>G.publish(),re=new Proxy({},{get(e,t){return t===Symbol.toPrimitive?L:t==="$"?L():(Z[t]||=g((n,c)=>{A.includes(t)||(globalThis.addEventListener(t,l=>$.get(l.target)?.[t]?.forEach?.(i=>i(l)),{passive:!0}),A+=t+"\0"),typeof n=="object"&&(n=n.fn),$.has(c)||$.set(c,{}),($.get(c)[t]||=[]).push(n)},void 0,{name:"on."+t})).publish()}});var q={},U={},J=/[A-Z]{1}/g,Q={},X=e=>Q[e]||="-"+e.toLowerCase(),_=e=>U[e]||=e.replaceAll(J,X),Y=g((e,t)=>t.style.cssText=Object.keys(e).map(n=>`${_(n)}:${e[n]};`).join("")),O=()=>Y.publish(),ce=new Proxy({},{get(e,t){return t===Symbol.toPrimitive?O:t==="$"?O():(q[t]||=g((n,c)=>{c.style[_(t)]=n})).publish()}});export{g as $,ce as css,te as h,y as isPtr,re as on};
