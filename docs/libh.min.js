var j={},W=function*(t=52){let e;for(let n=0;n<t;n++)e=Math.floor(Math.random()*31),yield 127+e+(e>141)+(e>156)},M=()=>String.fromCharCode(...W()),w=Symbol.for("PTR_IDENTIFIER"),E={or:(t,e)=>t||e,and:(t,e)=>t&&e,xor:(t,e)=>t^e,sum:(t,e)=>t+e,sub:(t,e)=>t-e,mul:(t,e)=>t*e,div:(t,e)=>t/e,mod:(t,e)=>t%e},D=Object.assign({[Symbol.toPrimitive]([t],e){return typeof e=="string"?e==="string"&&typeof t=="function"?this.publish():t.toString():e===w},watch(t,e){return e&&t[2].set(e,[t[1].push(e)-1,!0]),this},abort(t,e){if(e){let n=t[2].get(e);n[1]=!1,delete t[1][n?.[0]]}return this},into([t],e=n=>n){let n=T(e(t));return this.watch(o=>n.$=e(o)),n},until(t,e){return new Promise(n=>{let o=l=>(typeof e=="function"?e(l):l===e)?(this.abort(o),n(this)):0;this.watch(o)})},switch(){return this.$=!this.$,this},not(){return this.into(t=>!t)},bool(){return this.into(t=>!!t)},tick(){let t=!1;return this.into(()=>t=!t)},toString(t,e){let n=p(e),o=this.into(l=>l.toString(n?e.$:e));return n&&e.watch(l=>o.$=this.$.toString(l)),o},publish(t){let e=Symbol(t[3]);return j[e]=this,e},text(){let t=new Text(this.$);return this.watch(e=>t.textContent=e),[t]}},...Object.keys(E).map(t=>({[t](e,n){let o=p(n),l=E[t],f=this.into(u=>l(u,o?n.$:n));return o&&n.watch(u=>f.$=l(this.$,u)),f}}))),p=t=>t?.[w],T=(t,e=o=>o,n={})=>{let o=[],l=new WeakMap,f=Object.assign({name:"$"},n),u=function(s,r,d){return(r||s!==i[0])&&(i[0]=s,o.forEach(a=>l.get(a)?.[1]?a(s):0)),d},i=[t,o,l,x+(n.name||""),u];return new Proxy(Object.defineProperties(Object(function(...s){let[r]=i;return typeof r=="function"?r.apply(null,s):r}),{name:{value:f.name}}),{get(s,r,d){let[a]=i;return r==="$"?a:r==="refresh"?u.bind(null,a,!0,d):r===w?!0:D[r]?.bind?.(d,i)||(typeof a[r]=="function"?function(...c){let h=c.map((m,g)=>p(m)?(m.watch(H=>(h[g]=H,b.$=d.$[r](...h))),m.$):m),b=d.into(m=>m[r](...h));return b}:d.into(c=>c[r]))},set(s,r,d){if(r=="$"){let a=e(d);a instanceof Promise?a.then(u):u(a)}return!0}})},S=t=>Object.isFrozen(t)&&Array.isArray(t),z=(t,...e)=>{let n=M(),o=t.join(n),l=new RegExp(n,"g"),f=e.map((s,r)=>p(s)?(s.watch(()=>(f[r]=s.$,i.$=u())),s.$):s),u=(s=0)=>o.replaceAll(l,()=>f[s++]),i=T(u());return i},y=(...t)=>(S(t[0])&&S(t[0]?.raw)?z:T).apply(null,t),x;for(;(x=M())in globalThis;);Object.defineProperty(globalThis,x,{value:t=>j[t],configurable:!1,enumerable:!1});var A=16,I=Symbol.for("HTML_IDENTIFIER"),F=function*(t=A){for(let e=0;e<t;e++)yield Math.floor(Math.random()*26)+97},O=new WeakMap,V=document.createDocumentFragment(),Z={[Symbol.toPrimitive](t){return typeof t=="string"?[...this[Symbol.iterator]().map(e=>e.outerHTML)].join(""):t===I},toString(){return this[Symbol.toPrimitive]("string")}},G={get(t,e){let n=t[e];return typeof n=="function"&&n.toString().endsWith("() { [native code] }")?n.bind(t):n}},C=(t,e)=>Reflect.ownKeys(e).forEach(t.bind(!1,e)),et=(t,...e)=>{let n=O.get(t);if(!n){let i=t.join(""),s,r=0;for(;i.includes(s=String.fromCharCode(...F())););i=t.join(s);let d=[...i.matchAll(new RegExp(`<(?:(!--|\\/[^a-zA-Z])|(\\/?[a-zA-Z][^>\\s]*)|(\\/?$))[\\s].*?${s}`,"g"))].map(({0:{length:h},index:b})=>b+h),a=[],c=document.createElement("div");V.appendChild(c),c.innerHTML=i.replaceAll(s,(h,b)=>(a[r++]=d.includes(b+A))?s:`<br ${s}>`),O.set(t,n=()=>[c.cloneNode(!0),a,s])}let[o,l,f]=n(),u={};return o.querySelectorAll(`[${f}]`).forEach((i,s)=>{let r=e[s];if(l[s]){let d=function(a,c){let h=a[c],b=typeof c;if(b=="symbol"){let m=globalThis[c.description.slice(0,52)]?.(c);if(!p(m))return;let g=m.$(h,i);if(g?.constructor!==Object)return;C(d,g)}else if(b=="string")if(p(h))if("value\0checked".includes(c)&&c in i){i[c]=h.$;let m=g=>i[c]=g;h.watch(m),i.addEventListener("input",({target:{[c]:g}})=>{h.$="number\0range".includes(i.type)?Number(g):g},{passive:!0})}else i[c]=h.$,h.watch(m=>i[c]=m);else c=="id"&&!(h in u)?u[h]=new Proxy(i,G):i[c]=h};C(d,r)}else i.replaceWith(...r[Symbol.toPrimitive]?.(I)?r:p(r)?r.text():[new Text(r)]);i.removeAttribute(f)}),Object.assign(o.childNodes,Z,{then(i){return i(u),this}})};var P="",K={},_=(t,e,n)=>e.addEventListener(n,t,{passive:!0}),q=y((t,e)=>Object.keys(t).forEach(n=>_(t[n],e,n))),$=new WeakMap,R=()=>q.publish(),it=new Proxy({},{get(t,e){return e===Symbol.toPrimitive?R:e==="$"?R():(K[e]||=y((n,o)=>{P.includes(e)||(_(l=>$.get(l.target)?.[e]?.forEach?.(f=>f(l)),globalThis,e),P+=e+"\0"),typeof n=="object"&&(n=n.fn),$.has(o)||$.set(o,{}),($.get(o)[e]||=[]).push(n)},void 0,{name:"on."+e})).publish()}});var N={},J={},Q=/[A-Z]{1}/g,U={},X=t=>U[t]||="-"+t.toLowerCase(),L=t=>J[t]||=t.replaceAll(Q,X),B=(t,e,n)=>p(e)?(e.watch(o=>n.style[L(t)]=o),e.$):e,Y=y((t,e)=>e.style.cssText=Object.keys(t).map(n=>`${L(n)}:${B(n,t[n],e)};`).join("")),k=()=>Y.publish(),ct=new Proxy({},{get(t,e){return e===Symbol.toPrimitive?k:e==="$"?k():N[e]||=y((n,o)=>B(e,n,o)).publish()}});export{y as $,ct as css,et as h,p as isPtr,it as on};
